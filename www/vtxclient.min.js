var tnInit=function(){var a;tnQHim.fill(TNQ_NO);tnQUs.fill(TNQ_NO);tnQUs[TN_BIN]=TNQ_WANTYES;tnQHim[TN_BIN]=TNQ_WANTYES;tnQUs[TN_SGA]=TNQ_WANTYES;tnQHim[TN_SGA]=TNQ_WANTYES;tnQHim[TN_ECHO]=TNQ_WANTYES;tnQUs[TN_NAWS]=TNQ_WANTYES;tnQUs[TN_TTYPE]=TNQ_WANTYES;tnQUs[TN_TSPEED]=TNQ_WANTYES;for(a=0;256>a;a++)tnQUs[a]==TNQ_WANTYES?tnSendCmd(TN_WILL,a):tnQUs[a]==TNQ_WANTNO&&tnSendCmd(TN_WONT,a),tnQHim[a]==TNQ_WANTYES?tnSendCmd(TN_DO,a):tnQHim[a]==TNQ_WANTNO&&tnSendCmd(TN_DONT,a)},tnSendCmd=function(){var a,
b,d=[];d.push(TN_IAC);var c=arguments.length;for(a=0;a<c;a++)if("string"===typeof arguments[a]){var e=arguments[a].length;for(b=0;b<e;b++)d.push(arguments[a].charCodeAt(b))}else"number"===typeof arguments[a]&&d.push(arguments[a]);c=d.length;b=new Uint8Array(c);for(a=0;a<c;a++)b[a]=d[a];ws.send(b)},tnNegotiate=function(a){var b;var d=new Uint8Array(a.length);var c=0;var e=a.length;for(b=0;b<e;b++){var f=a[b];switch(tnState){case 0:f==TN_IAC?tnState++:d[c++]=f;break;case 1:switch(f){case TN_IAC:d[c++]=
f;tnState=0;break;case TN_SE:case TN_NOP:case TN_DM:case TN_BRK:case TN_IP:case TN_AO:case TN_AYT:case TN_EC:case TN_EL:case TN_GA:tnState=0;break;case TN_SB:tnState=3;break;case TN_WILL:case TN_WONT:case TN_DO:case TN_DONT:tnCmd=f;tnState=2;break;default:d[c++]=f,tnState=0}break;case 2:switch(tnCmd){case TN_WILL:if(tnQUs[f]==TNQ_WANTYES)tnQUs[f]=TNQ_YES;else switch(f){case TN_BIN:case TN_SGA:case TN_ECHO:case TN_NAWS:case TN_TTYPE:case TN_TSPEED:tnSendCmd(TN_DO,f);tnQHim[f]=TNQ_YES;break;default:tnSendCmd(TN_DONT,
f),tnQHim[f]=TNQ_NO}break;case TN_WONT:tnQUs[f]==TNQ_WANTYES||tnQUs[f]==TNQ_WANTNO?tnQUs[f]=TNQ_NO:(tnSendCmd(TN_DONT,f),tnQHim[f]=TNQ_NO);break;case TN_DO:if(tnQUs[f]==TNQ_WANTYES){if(tnQUs[f]=TNQ_YES,f==TN_NAWS){f=crtCols&255;var h=crtCols>>>8&255;var k=crtRows&255;var m=crtRows>>>8&255;tnSendCmd(TN_SB,TN_NAWS,h,f,m,k);tnSendCmd(TN_SE)}}else switch(f){case TN_BIN:case TN_SGA:case TN_ECHO:case TN_NAWS:case TN_TTYPE:case TN_TSPEED:tnSendCmd(TN_WILL,f);tnQUs[f]=TNQ_YES;break;default:tnSendCmd(TN_WONT,
f),tnQUs[f]=TNQ_NO}break;case TN_DONT:tnQUs[f]!=TNQ_WANTYES&&tnSendCmd(TN_WONT,f),tnQUs[f]=TNQ_NO}tnState=0;break;case 3:tnCmd=f;tnState=4;break;case 4:if(f==TN_SEND)switch(tnCmd){case TN_TTYPE:tnSendCmd(TN_SB,tnCmd,TN_IS,vtxdata.term);tnSendCmd(TN_SE);break;case TN_TSPEED:tnSendCmd(TN_SB,tnCmd,TN_IS,"921600,921600");tnSendCmd(TN_SE);break;case TN_NEWE:tnSendCmd(TN_SB,tnCmd,TN_IS,0);tnSendCmd(TN_SE);break;default:tnSendCmd(TN_DONT,tnCmd),d[c++]=f}tnState=0}}return d.slice(0,c)},conStrOut=function(a){var b;
a=a||"";var d=a.length;for(b=0;b<d;b++){var c=conBaud;conCharOut(a.charCodeAt(b));if(conBaud!=c){conBuffer=a.substring(b+1)+conBuffer;break}}},conBufferOut=function(a){conBuffer+=a;0==conBaud&&(conStrOut(conBuffer),conBuffer="")},doWriteBuffer=function(){if(0<conBuffer.length){if(0==conBaud){var a=conBuffer;conBuffer=""}else{var b=conBaud/300;conBuffer.length<b?(a=conBuffer,conBuffer=""):(a=conBuffer.substring(0,b),conBuffer=conBuffer.substring(b))}conStrOut(a)}},decodeHex3=function(a){var b,d;a=
a.replace(/\s/g,"");var c=new Uint8Array(a.length>>>1);var e=d=0;for(b=c.length;e<b;e++)c[e]=(a.charCodeAt(d)&15)<<4|a.charCodeAt(d+1)&15,d+=2;return c},stripNL=function(a){return a.replace(/\n/g," ").replace(/\s+/g," ")},moveSprite=function(a,b,d,c){var e=getElementPosition(getRowElement(b));b=getRowFontSize(b);var f=int(a.style.left),h=int(a.style.top);0>c&&(c=0);var k=d*b.width;var m=e.top-pageTop;var g=domElement("style",{},{},"@keyframes "+a.id+" { from { left: "+f+"px; top: "+h+"px; } to { left : "+
k+"px; top: "+m+"px;}} ");a.appendChild(g);a.style["animation-duration"]=c+"ms";a.style["animation-name"]=a.id;a.style["animation-iteration-count"]="1";a.style["animation-fill-mode"]="forwards";setTimeout(function(){a.style.left=k+"px";a.style.top=m+"px";a.style["animation-name"]=null;a.style["animation-duration"]=null;a.style["animation-iteration-count"]=null;a.style["animation-fill-mode"]=null;a.removeChild(g)},c+5)},conCharOut=function(a){var b,d=!1;var c=!1;if(modeTeletext)if(a==_ESC)cellAttr=
cellSaveAttr,modeAutoWrap=modeSaveAutoWrap,modeTeletext=!1;else{0==crsrCol&&(80<=crtCols&&(conRowAttr[crsrRow]&=~(A_ROW_DISPLAY_MASK|A_ROW_WIDTH_MASK),conRowAttr[crsrRow]|=A_ROW_WIDTH_200,adjustRow(crsrRow)),cellAttr=2684354560|ttxToAnsiColor[0]<<8|ttxToAnsiColor[7],ttxBottom=ttxSeparated=ttxGraphics=!1,ttxDouble&&(ttxBottom=!0),ttxHeld=ttxDouble=!1);if(ttxBottom)10==a?(crsrCol=0,crsrRow++,expandToRow(crsrRow)):(a=conText[crsrRow-1].charCodeAt(crsrCol),cellAttr=conCellAttr[crsrRow-1][crsrCol],getCellAttrDisplay(cellAttr)==
A_CELL_DISPLAY_TOP?cellAttr=setCellAttrDisplay(cellAttr,A_CELL_DISPLAY_BOTTOM):(cellAttr=setCellAttrDisplay(cellAttr,A_CELL_DISPLAY_NORMAL),a=32),conPrintChar(a));else switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:ttxGraphics=!1;cellAttr=setCellAttrFG(cellAttr,ttxToAnsiColor[a]);conPrintChar(32);break;case 8:case 9:cellAttr=setCellAttrBlinkFast(cellAttr,8==a);conPrintChar(32);break;case 10:crsrCol=0;crsrRow++;expandToRow(crsrRow);break;case 11:break;case 12:cellAttr=setCellAttrDisplay(cellAttr,
A_CELL_DISPLAY_NORMAL);conPrintChar(32);break;case 13:cellAttr=setCellAttrDisplay(cellAttr,A_CELL_DISPLAY_TOP);ttxDouble=!0;conPrintChar(32);break;case 14:case 15:case 16:break;case 17:case 18:case 19:case 20:case 21:case 22:case 23:ttxGraphics=!0;cellAttr=setCellAttrFG(cellAttr,ttxToAnsiColor[a-16]);conPrintChar(32);break;case 24:break;case 25:case 26:ttxSeparated=26==a;conPrintChar(32);break;case 28:cellAttr=setCellAttrBG(cellAttr,ttxToAnsiColors[0]);conPrintChar(32);break;case 29:cellAttr=setCellAttrBG(cellAttr,
getCellAttrFG(cellAttr));conPrintChar(32);break;case 30:case 31:txtHeld=30==a;conPrintChar(32);break;default:a&=127,cellAttr=setCellAttrFont(cellAttr,ttxGraphics?ttxSeparated?12:11:10),conPrintChar(a)}d=!0}else if(cbm)switch(a){case 3:break;case 5:cellAttr=setCellAttrFG(cellAttr,1);break;case 7:soundBell.pause();soundBell.play();break;case 8:modeCBMShift=!1;break;case 9:modeCBMShift=!0;break;case 13:case 141:crsrCol=0;crsrRow++;d=!0;cellAttr=setCellAttrReverse(cellAttr,!1);break;case 14:conFontNum=
1;renderAll();break;case 17:crsrRow++;d=!0;break;case 18:cellAttr=setCellAttrReverse(cellAttr,!0);break;case 19:crsrCol=crsrRow=0;d=!0;break;case 20:0<crsrCol&&crsrCol--;delChar(crsrRow,crsrCol);redrawRow(crsrRow);d=!0;break;case 28:cellAttr=setCellAttrFG(cellAttr,2);crsrAttr=setCrsrAttrColor(2);break;case 29:crsrCol++;crsrCol>crtCols&&(crsrCol=0,crsrRow++);d=!0;break;case 30:cellAttr=setCellAttrFG(cellAttr,5);crsrAttr=setCrsrAttrColor(5);break;case 31:cellAttr=setCellAttrFG(cellAttr,6);crsrAttr=
setCrsrAttrColor(6);break;case 129:cellAttr=setCellAttrFG(cellAttr,8);crsrAttr=setCrsrAttrColor(8);break;case 133:case 134:case 135:case 136:case 137:case 138:case 139:case 140:break;case 142:conFontNum=0;renderAll();break;case 144:cellAttr=setCellAttrFG(cellAttr,0);crsrAttr=setCrsrAttrColor(0);break;case 145:0<crsrRow&&crsrRow--;d=!0;break;case 146:cellAttr=setCellAttrReverse(cellAttr,!1);break;case 147:c=document.getElementsByClassName("vtx");var e=c.length;for(b=e-1;0<=b;b--)c[b].parentNode.removeChild(c[b]);
conRowAttr=[];conCellAttr=[];conText=[];document.body.style.cursor="default";crsrRow=crsrCol=0;d=!0;break;case 148:insChar(crsrRow,crsrCol,32);redrawRow(crsrRow);break;case 149:cellAttr=setCellAttrFG(cellAttr,9);crsrAttr=setCrsrAttrColor(9);break;case 150:cellAttr=setCellAttrFG(cellAttr,10);crsrAttr=setCrsrAttrColor(10);break;case 151:cellAttr=setCellAttrFG(cellAttr,11);crsrAttr=setCrsrAttrColor(11);break;case 152:cellAttr=setCellAttrFG(cellAttr,12);crsrAttr=setCrsrAttrColor(12);break;case 153:cellAttr=
setCellAttrFG(cellAttr,13);crsrAttr=setCrsrAttrColor(13);break;case 154:cellAttr=setCellAttrFG(cellAttr,14);crsrAttr=setCrsrAttrColor(14);break;case 155:cellAttr=setCellAttrFG(cellAttr,15);crsrAttr=setCrsrAttrColor(15);break;case 156:cellAttr=setCellAttrFG(cellAttr,4);crsrAttr=setCrsrAttrColor(4);break;case 157:0<crsrCol&&crsrCol--;d=!0;break;case 158:cellAttr=setCellAttrFG(cellAttr,7);crsrAttr=setCrsrAttrColor(7);break;case 159:cellAttr=setCellAttrFG(cellAttr,3);crsrAttr=setCrsrAttrColor(3);break;
default:32<=(a&127)&&(conPrintChar(a),d=!0)}else if(atari)switch(a){case 28:0<crsrRow&&crsrRow--;d=!0;break;case 29:crsrRow++;d=!0;break;case 30:0<crsrCol&&crsrCol--;d=!0;break;case 31:crsrCol++;crsrCol>crtCols&&(crsrCol=0,crsrRow++);d=!0;break;case 125:c=document.getElementsByClassName("vtx");e=c.length;for(b=e-1;0<=b;b--)c[b].parentNode.removeChild(c[b]);conRowAttr=[];conCellAttr=[];conText=[];document.body.style.cursor="default";crsrRow=crsrCol=0;d=!0;break;case 126:0<crsrCol&&crsrCol--;d=!0;break;
case 127:for(b=crsrCol+1;b<crtCols;b++)if(conTabStop[b]){crsrCol=b;d=!0;break}break;case 155:crsrCol=0;crsrRow++;d=!0;cellAttr=setCellAttrReverse(cellAttr,!1);break;case 156:delRow(crsrRow);break;case 157:insRow(crsrRow);break;case 158:case 159:conTabStop[crsrCol]=159==a;break;case 253:soundBell.pause();soundBell.play();break;case 254:expandToRow(crsrRow);expandToCol(crsrRow,crsrCol);delChar(crsrRow,crsrCol);redrawRow(crsrRow);d=!0;break;case 255:break;default:cellAttr=setCellAttrReverse(cellAttr,
a&128),conPrintChar(a&127),d=!0}else{if(modeNextGlyph)conPrintChar(a),d=!0,modeNextGlyph=!1;else switch(a){case _NUL:modeDOORWAY&&(modeNextGlyph=!0);break;case _BEL:soundBell.pause();soundBell.play();break;case _BS:0<crsrCol&&(expandToRow(crsrRow),expandToCol(crsrRow,crsrCol),crsrCol--,d=!0);break;case _HT:crsrCol=(crsrCol>>>3)+1<<3;crsrCol>colsOnRow(crsrRow)&&(crsrCol=colsOnRow(crsrRow));d=!0;break;case _LF:modeVTXANSI||(crsrCol=0);crsrRow++;d=!0;break;case _CR:crsrCol=0;d=!0;break;case _DEL:between(conFontNum,
10,12)?(expandToRow(crsrRow),expandToCol(crsrRow,crsrCol),delChar(crsrRow,crsrCol),redrawRow(crsrRow)):conPrintChar(a);d=!0;break;default:switch(ansiState){case 0:a==_ESC?ansiState=1:(conPrintChar(a),d=!0);break;case 1:91==a?(interm=parms="",ansiState=2):35==a?ansiState=3:55==a?(crsrSaveRow=crsrRow,crsrSaveCol=crsrCol,cellSaveAttr=cellAttr,ansiState=0):56==a?(crsrRow=crsrSaveRow,crsrCol=crsrSaveCol,cellAttr=cellSaveAttr,ansiState=0):68==a?(scrollUp(),ansiState=0):69==a?(crsrRow++,d=!0,ansiState=0):
77==a?(scrollDown(),ansiState=0):99==a?resetTerminal():ansiState=0;break;case 2:between(a,48,63)?parms+=String.fromCharCode(a):between(a,32,47)?(interm=String.fromCharCode(a),ansiState=5):between(a,64,126)?(ansiState=0,c=!0):ansiState=0;break;case 3:switch(a){case 48:conRowAttr[crsrRow]=defRowAttr;break;case 49:conRowAttr[crsrRow]&=~(A_ROW_DISPLAY_MASK|A_ROW_WIDTH_MASK);conRowAttr[crsrRow]=conRowAttr[crsrRow]|A_ROW_DISPLAY_TOP|A_ROW_WIDTH_100;break;case 50:conRowAttr[crsrRow]&=~(A_ROW_DISPLAY_MASK|
A_ROW_WIDTH_MASK);conRowAttr[crsrRow]=conRowAttr[crsrRow]|A_ROW_DISPLAY_BOTTOM|A_ROW_WIDTH_100;break;case 51:conRowAttr[crsrRow]&=~(A_ROW_DISPLAY_MASK|A_ROW_WIDTH_MASK);conRowAttr[crsrRow]=conRowAttr[crsrRow]|A_ROW_DISPLAY_TOP|A_ROW_WIDTH_200;break;case 52:conRowAttr[crsrRow]&=~(A_ROW_DISPLAY_MASK|A_ROW_WIDTH_MASK);conRowAttr[crsrRow]=conRowAttr[crsrRow]|A_ROW_DISPLAY_BOTTOM|A_ROW_WIDTH_200;break;case 53:conRowAttr[crsrRow]&=~(A_ROW_DISPLAY_MASK|A_ROW_WIDTH_MASK);conRowAttr[crsrRow]|=A_ROW_WIDTH_100;
break;case 54:conRowAttr[crsrRow]&=~(A_ROW_DISPLAY_MASK|A_ROW_WIDTH_MASK);conRowAttr[crsrRow]|=A_ROW_WIDTH_200;break;case 55:conRowAttr[crsrRow]&=~A_ROW_MARQUEE;getRowElement(crsrRow).firstChild.classList.remove("marquee");break;case 56:conRowAttr[crsrRow]|=A_ROW_MARQUEE,getRowElement(crsrRow).firstChild.classList.add("marquee")}adjustRow(crsrRow);ansiState=0;break;case 5:between(a,32,47)?interm+=String.fromCharCode(a):between(a,64,126)?(ansiState=0,c=!0):ansiState=0}}if(c){c=parms.split(";");""==
c[0]&&(c=[]);e=c.length;for(b=0;b<e;b++){var f=int(c[b]);f.toString()==c[b]&&(c[b]=f)}switch(a){case 64:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)insChar(crsrRow,crsrCol,32);redrawRow(crsrRow);break;case 65:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);crsrRow-=c[0];modeRegionOrigin?crsrRow<regionTopRow&&(crsrRow=regionTopRow):0>crsrRow&&(crsrRow=0);d=!0;break;case 66:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);crsrRow+=c[0];modeRegionOrigin&&crsrRow>regionBottomRow&&(crsrRow=regionBottomRow);
d=!0;break;case 67:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);crsrCol+=c[0];crsrCol>=colsOnRow(crsrRow)-1&&(crsrCol=colsOnRow(crsrRow)-1);d=!0;break;case 68:if(" "==interm){c=fixParams(c,[0,0]);switch(c[1]){case 0:case 26:conFont[c[0]]=fontName;conFontCP[c[0]]="CP437";break;case 5:conFont[c[0]]=fontName;conFontCP[c[0]]="CP866";break;case 17:case 18:conFont[c[0]]=fontName;conFontCP[c[0]]="CP850";break;case 25:case 27:case 29:conFont[c[0]]=fontName;conFontCP[c[0]]="CP866";break;case 19:case 28:conFont[c[0]]=
fontName;conFontCP[c[0]]="CP885";break;case 31:conFont[c[0]]=fontName;conFontCP[c[0]]="CP1131";break;case 1:case 20:conFont[c[0]]=fontName;conFontCP[c[0]]="WIN1251";break;case 2:case 12:case 22:conFont[c[0]]=fontName;conFontCP[c[0]]="KOI8_R";break;case 9:conFont[c[0]]=fontName;conFontCP[c[0]]="KOI8_U";break;case 24:case 30:conFont[c[0]]=fontName;conFontCP[c[0]]="ISO8859_1";break;case 3:conFont[c[0]]=fontName;conFontCP[c[0]]="ISO8859_2";break;case 4:case 11:case 13:case 23:conFont[c[0]]=fontName;conFontCP[c[0]]=
"ISO8859_4";break;case 14:conFont[c[0]]=fontName;conFontCP[c[0]]="ISO8859_5";break;case 21:conFont[c[0]]=fontName;conFontCP[c[0]]="ISO8859_7";break;case 6:conFont[c[0]]=fontName;conFontCP[c[0]]="ISO8859_9";break;case 10:case 16:conFont[c[0]]=fontName;conFontCP[c[0]]="ISO8859_15";break;case 15:conFont[c[0]]=fontName;conFontCP[c[0]]="ARMSCII_8";break;case 7:conFont[c[0]]=fontName;conFontCP[c[0]]="HAIK8";break;case 32:conFont[c[0]]="C640";conFontCP[c[0]]="RAW";break;case 33:conFont[c[0]]="C641";conFontCP[c[0]]=
"RAW";break;case 34:conFont[c[0]]="C1280";conFontCP[c[0]]="RAW";break;case 35:conFont[c[0]]="C1281";conFontCP[c[0]]="RAW";break;case 36:conFont[c[0]]="ATARI";conFontCP[c[0]]="RAW";break;case 37:conFont[c[0]]="P0TNOODLE";conFontCP[c[0]]="RAW";break;case 38:conFont[c[0]]="MOSOUL";conFontCP[c[0]]="RAW";break;case 39:conFont[c[0]]="MICROKNIGHTPLUS";conFontCP[c[0]]="RAW";break;case 40:conFont[c[0]]="TOPAZPLUS";conFontCP[c[0]]="RAW";break;case 41:conFont[c[0]]="MICROKNIGHT";conFontCP[c[0]]="RAW";break;
case 42:conFont[c[0]]="TOPAZ";conFontCP[c[0]]="RAW";break;case 100:conFont[c[0]]="TI994";conFontCP[c[0]]="RAWHI";break;case 101:conFont[c[0]]=fontName,conFontCP[c[0]]="TELETEXT"}loadSingleFont(conFont[c[0]])}else c=fixParams(c,[1]),c[0]=minMax(c[0],1,999),crsrCol-=c[0],0>crsrCol&&(crsrCol=0),d=!0;break;case 69:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);crsrCol=0;crsrRow+=c[0];d=!0;break;case 70:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);crsrCol=0;crsrRow-=c[0];0>crsrRow&&(crsrRow=0);d=!0;break;case 71:c=
fixParams(c,[1]);c[0]=minMax(c[0],1,999);crsrCol=c[0]-1;d=!0;break;case 73:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)if(crsrCol=(crsrCol>>>3)+1<<3,crsrCol>colsOnRow(crsrRow)){crsrCol=colsOnRow(crsrRow);break}d=!0;break;case 74:c=fixParams(c,[0]);c[0]=minMax(c[0],0,2,0);expandToRow(crsrRow);expandToCol(crsrRow,crsrCol);switch(c[0]){case 0:clearHotSpotsRow(crsrRow,crsrCol,999);conCellAttr[crsrRow].length=crsrCol;conText[crsrRow]=conText[crsrRow].substring(0,crsrCol);clearHotSpotsRows(crsrRow+
1,conRowAttr.length);for(b=getMaxRow();b>crsrRow;b--)e=getRowElement(b),e.parentNode.removeChild(e),conRowAttr.length=crsrRow+1,conCellAttr.length=crsrRow+1,conText.length=crsrRow+1;break;case 1:clearHotSpotsRow(crsrRow,0,crsrCol-1);for(c=0;c<=crsrCol;c++)conPutChar(crsrRow,c,32,defCellAttr);redrawRow(crsrRow);clearHotSpotsRows(0,crsrRow-1);for(b=0;b<crsrRow;b++)conRowAttr[b]=defRowAttr,conCellAttr[b]=[],conText[b]="",adjustRow(crsrRow),redrawRow(crsrRow);break;case 2:c=document.getElementsByClassName("vtx");
e=c.length;for(b=e-1;0<=b;b--)c[b].parentNode.removeChild(c[b]);c=document.getElementsByClassName("sprite");e=c.length;for(b=e-1;0<=b;b--)c[b].parentNode.removeChild(c[b]);conRowAttr=[];conCellAttr=[];conText=[];conHotSpots=[];lastHotSpot=null;document.body.style.cursor="default";modeVTXANSI?(expandToRow(crsrRow),expandToCol(crsrRow,crsrCol)):(crsrRow=crsrCol=0,d=!0);modeVTXANSI&&(cellAttr=defCellAttr)}break;case 75:c=fixParams(c,[0]);c[0]=minMax(c[0],0,2,0);expandToRow(crsrRow);expandToCol(crsrRow,
crsrCol);switch(c[0]){case 0:clearHotSpotsRow(crsrRow,crsrCol,999);conCellAttr[crsrRow].length=crsrCol;conText[crsrRow]=conText[crsrRow].substring(0,crsrCol);redrawRow(crsrRow);break;case 1:clearHotSpotsRow(crsrRow,0,crsrCol);for(c=0;c<=crsrCol;c++)conPutChar(crsrRow,c,32,defCellAttr);redrawRow(crsrRow);break;case 2:clearHotSpotsRow(crsrRow,0,999),conText[crsrRow]="",conCellAttr[crsrRow]=[],redrawRow(crsrRow)}break;case 76:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)insRow(crsrRow);
break;case 77:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)delRow(crsrRow);break;case 80:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)delChar(crsrRow,crsrCol);redrawRow(crsrRow);break;case 83:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)scrollUp();break;case 84:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)scrollDown();break;case 88:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)conPutChar(crsrRow,crsrCol+b,32,defCellAttr);
break;case 90:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)if(crsrCol=((crsrCol>>>3)+1<<3)-16,0>=crsrCol){crsrCol=0;break}d=!0;break;case 91:c=fixParams(c,[3,1]);c[0]=minMax(c[0],0,7,3);c[1]=minMax(c[1],0,3,1);conRowAttr[crsrRow]=setRowAttrHeight(conRowAttr[crsrRow],25*(c[0]+1));conRowAttr[crsrRow]=setRowAttrWidth(conRowAttr[crsrRow],50*(c[1]+1));adjustRow(crsrRow);d=!0;break;case 92:if(2>e)conHotSpots=[];else switch(c[0]){case 0:case 1:if(4<=e){a={type:c[0],row:crsrRow,col:crsrCol,
width:c[1],height:c[2],hilite:c[3],val:""};for(b=4;b<e;b++)a.val+=String.fromCharCode(c[b]);conHotSpots.push(a)}}break;case 93:c=fixParams(c,[0,0,0]);c[0]=minMax(c[0],0,255,0);c[1]=minMax(c[1],0,255,0);c[2]=minMax(c[2],0,3,0);conRowAttr[crsrRow]=setRowAttrColor1(conRowAttr[crsrRow],c[0]);conRowAttr[crsrRow]=setRowAttrColor2(conRowAttr[crsrRow],c[1]);conRowAttr[crsrRow]=setRowAttrPattern(conRowAttr[crsrRow],c[2]<<16);e=getRowElement(crsrRow);b=ansiColors[c[0]];a=ansiColors[c[1]];switch(c[2]<<16){case A_ROW_PATTERN_SOLID:e.style.background=
b;break;case A_ROW_PATTERN_HORZ:e.style.background="linear-gradient(to bottom,"+b+","+a+")";break;case A_ROW_PATTERN_VERT:e.style.background="linear-gradient(to right,"+b+","+a+")"}break;case 94:if(c.length)switch(c[0]){case 0:crsrAttr=1==e?setCrsrAttrColor(crsrAttr,getCrsrAttrColor(defCrsrAttr)):setCrsrAttrColor(crsrAttr,c[1]&255);newCrsr();break;case 1:crsrAttr=1==e?setCrsrAttrSize(crsrAttr,getCrsrAttrSize(defCrsrAttr)):setCrsrAttrSize(crsrAttr,c[1]&3);newCrsr();break;case 2:crsrAttr=1==e?setCrsrAttrOrientation(crsrAttr,
c[1]?A_CRSR_ORIENTATION:0):setCrsrAttrOrientation(crsrAttr,getCrsrAttrOrientation(defCrsrAttr));newCrsr();break;case 3:pageAttr=1==e?setPageAttrBorder(pageAttr,getPageAttrBorder(defPageAttr)):setPageAttrBorder(pageAttr,c[1]&255);b=cbm?cbmColors[pageAttr>>>8&15]:atari?atariColors[pageAttr>>>8&1]:ansiColors[pageAttr>>>8&255];pageDiv.parentNode.style["background-color"]=b;break;case 4:pageAttr=1==e?setPageAttrBackground(pageAttr,getOageAttrBackground(defPageAttr)):setPageAttrBackground(pageAttr,c[1]&
255);b=cbm?cbmColors[pageAttr&15]:atari?atariColors[pageAttr&1]:ansiColors[pageAttr&255];pageDiv.style["background-color"]=b;break;case 5:hotspotHoverAttr=cellAttr;break;case 6:hotspotClickAttr=cellAttr}d=!0;break;case 95:if(0==parms.length){console.log("CSI "+parms+interm+String.fromCharCode(a));break}if(0==c[0])switch(c[1]){case 0:if(2==e)spriteDefs=[];else if(3==e)spriteDefs[c[2]]=null;else if(4<e)switch(a="",c[3]){case 0:for(b=4;b<e;b++)a+=String.fromCharCode(int(c[b]));spriteDefs[c[2]]=stripNL(a);
break;case 1:for(b=4;b<e;b++)a+=";"+c[b];a=a.substring(1);spriteDefs[c[2]]=stripNL(UFT8ArrayToStr(decodeHex3(a)));break;case 2:for(b=4;b<e;b++)a+=";"+c[b];a=a.substring(1);spriteDefs[c[2]]="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(stripNL(UFT8ArrayToStr(decodeHex3(a))));break;case 3:for(b=4;b<e;b++)a+=";"+c[b];a=a.substring(1);spriteDefs[c[2]]="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(stripNL(UFT8ArrayToStr(inflateRaw(decodeHex3(a)))));break;case 4:for(b=4;b<e;b++)a+=";"+
c[b];a=a.substring(1);spriteDefs[c[2]]="data:image/svg+xml;base64,"+stripNL(UFT8ArrayToStr(decodeHex3(a)))}break;case 1:if(2==e)for(c=document.getElementsByClassName("sprite"),b=c.length-1;0<=b;b--)c[b].parentNode.removeChild(c[b]);else 3==e?(e=document.getElementById("sprite"+c[2]),null!=e&&e.parentNode.removeChild(e)):7==e&&(e=document.getElementById("sprite"+c[2]),null!=e&&e.parentNode.removeChild(e),b=getElementPosition(getRowElement(crsrRow)),e=getRowFontSize(crsrRow),b=b.top-pageTop,e=crsrCol*
e.width,e=domElement("div",{className:"sprite",row:crsrRow,col:crsrCol,id:"sprite"+c[2]},{position:"absolute",left:e+"px",top:b+"px",backgroundColor:"green",width:colSize*c[4]+"px",height:rowSize*c[5]+"px",overflow:"hidden"}),b=domElement("img",{onload:fitSVGToDiv,src:spriteDefs[c[3]]},{visibility:"hidden",position:"relative",left:"0px",top:"0px"}),e.appendChild(b),0==c[6]?pageDiv.insertBefore(e,textDiv):textDiv.appendChild(e));break;case 2:(b=document.getElementById("sprite"+c[2]))&&6==e&&moveSprite(b,
c[3],c[4],c[5])}else if(1==c[0])switch(c[1]){case 0:if(2==e)audioDefs=[];else if(3==e)audioDefs[c[2]]=null;else if(4<e)switch(a="",c[3]){case 0:for(b=4;b<e;b++)a+=String.fromCharCode(int(c[b]));audioDefs[c[2]]=a;break;case 1:for(b=4;b<e;b++)a+=";"+c[b];a=a.substring(1);audioDefs[c[2]]=UFT8ArrayToStr(decodeHex3(a));break;case 2:audioDefs[c[2]]="data:audio/mp3;base64,"+btoa(decodeHex3(a));break;case 3:audioDefs[c[2]]="data:audio/mp3;base64,"+btoa(inflateRaw(decodeHex3(a)));break;case 4:audioDefs[c[2]]=
"data:audio/mp3;base64,"+ +stripNL(UFT8ArrayToStr(decodeHex3(a)))}break;case 1:2<e&&(audio.src=audioDefs[c[2]]);break;case 2:switch(c[2]){case 0:audio.pause();audio.load();break;case 1:audio.play();break;case 2:audio.pause()}break;case 3:audio.volume=null!=c[2]?c[2]/100:.25}break;case 98:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);for(b=0;b<c[0];b++)conPrintChar(lastChar);d=!0;break;case 99:c=fixParams(c,[0]);0==c[0]&&sendData(CSI+"?50;86;84;88c");break;case 102:case 72:c=fixParams(c,[1,1]);c[0]=minMax(c[0],
1,999);for(c[1]=minMax(c[1],1,999);2>e;)c[e++]=1;crsrRow=modeRegionOrigin?regionTopRow+c[0]-1:c[0]-1;crsrCol=c[1]-1;expandToRow(crsrRow);d=!0;break;case 104:case 108:c[0]=c[0].toString();switch(c[0]){case "?6":modeRegionOrigin=104==a;break;case "?7":modeAutoWrap=104==a;break;case "?25":modeCursor=104==a;break;case "?31":modeBoldFont=104==a;break;case "?32":modeNoBold=104==a;break;case "?33":modeBlinkBright=104==a;break;case "?34":modeBlinkFont=104==a;break;case "?35":modeNoBlink=104==a;break;case "?50":modeVTXANSI=
104==a;break;case "?51":crsrCol=0;cellSaveAttr=cellAttr;modeSaveAutoWrap=modeAutoWrap;ttxBottom=modeAutoWrap=!1;modeTeletext=!0;break;case "=255":modeDOORWAY=104==a}break;case 109:0==e&&(c[e++]=0);c[0]=minMax(c[0],0,255);for(b=0;b<e;b++)switch(c[b]){case 0:cellAttr=defCellAttr;break;case 1:case 21:cellAttr=setCellAttrBold(cellAttr,20>c[b]);break;case 2:case 22:cellAttr=setCellAttrFaint(cellAttr,20>c[b]);break;case 3:case 23:cellAttr=setCellAttrItalics(cellAttr,20>c[b]);break;case 4:case 24:cellAttr=
setCellAttrUnderline(cellAttr,20>c[b]);break;case 5:cellAttr&=~(A_CELL_BLINKSLOW|A_CELL_BLINKFAST);cellAttr|=A_CELL_BLINKSLOW;break;case 6:cellAttr&=~(A_CELL_BLINKSLOW|A_CELL_BLINKFAST);cellAttr|=A_CELL_BLINKFAST;break;case 25:case 26:cellAttr&=~(A_CELL_BLINKSLOW|A_CELL_BLINKFAST);break;case 7:case 27:cellAttr=setCellAttrReverse(cellAttr,20>c[b]);break;case 8:case 28:cellAttr=setCellAttrDisplay(cellAttr,20>c[b]?A_CELL_DISPLAY_CONCEAL:A_CELL_DISPLAY_NORMAL);break;case 9:case 29:cellAttr=setCellAttrStrikethrough(cellAttr,
20>c[b]);break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:cellAttr=setCellAttrFont(cellAttr,c[b]-10);break;case 56:case 76:cellAttr=setCellAttrOutline(cellAttr,70>c[b]);break;case 57:case 77:cellAttr=setCellAttrShadow(cellAttr,70>c[b]);break;case 58:case 78:cellAttr=setCellAttrDisplay(cellAttr,70>c[b]?A_CELL_DISPLAY_TOP:A_CELL_DISPLAY_NORMAL);break;case 59:case 79:cellAttr=setCellAttrDisplay(cellAttr,70>c[b]?A_CELL_DISPLAY_BOTTOM:A_CELL_DISPLAY_NORMAL);break;case 80:case 81:case 82:case 83:case 84:case 85:cellAttr=
setCellAttrFont(cellAttr,c[b]-70);break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:cellAttr=setCellAttrFG(cellAttr,c[b]-30);break;case 38:++b<e&&5==c[b]&&++b<e&&(c[b]=minMax(c[b],0,255,7),cellAttr=setCellAttrFG(cellAttr,c[b]));break;case 39:cellAttr=setCellAttrFG(cellAttr,getCellAttrFG(defCellAttr));break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:cellAttr=setCellAttrFG(cellAttr,c[b]-90+8);break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:cellAttr=
setCellAttrBG(cellAttr,c[b]-40);break;case 48:++b<e&&5==c[b]&&++b<e&&(c[b]=minMax(c[b],0,255,7),cellAttr=setCellAttrBG(cellAttr,c[b]));break;case 49:cellAttr=setCellAttrBG(cellAttr,getCellAttrBG(defCellAttr));break;case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:cellAttr=setCellAttrBG(cellAttr,c[b]-100+8)}break;case 110:c=fixParams(c,[1]);c[0]=minMax(c[0],1,999);6==c[0]&&sendData(CSI+(crsrRow+1)+";"+(crsrCol+1)+"R");break;case 114:"*"==interm?(c=fixParams(c,[0,0]),2>c[0]&&
(conBaud=100*bauds[c[1]])):""==interm&&(0==c.length?(regionTopRow=0,regionBottomRow=crtRows-1):(c=fixParams(c,[1,1]),c[0]=minMax(c[0],1,crtRows),c[1]=minMax(c[1],c[0],crtRows),regionTopRow=c[0]-1,regionBottomRow=c[1]-1));break;case 115:crsrSaveRow=crsrRow;crsrSaveCol=crsrCol;break;case 117:crsrRow=crsrSaveRow,crsrCol=crsrSaveCol,d=!0}}}d&&crsrDraw()},resetTerminal=function(){var a;modeBlinkBright=modeVTXANSI=!1;modeCursor=!0;modeNoBlink=modeBlinkFont=modeNoBold=modeBoldFont=!1;conBaud=0;modeDOORWAY=
!1;cellAttr=defCellAttr;pageAttr=defPageAttr;crsrAttr=defCrsrAttr;pageDiv.parentNode.style["background-color"]=ansiColors[pageAttr>>>8&255];pageDiv.style["background-color"]=ansiColors[pageAttr&255];for(a=conFontNum=0;10>a;a++)conFont[a]=fontName,conFontCP[a]=codePage;for(a=10;13>a;a++)conFont[a]=fontName,conFontCP[a]="TELETEXT"},conPrintChar=function(a){crsrSkipTime=(new Date).getTime();conPutChar(crsrRow,crsrCol,a,cellAttr);crsrCol++;modeAutoWrap?crsrCol==colsOnRow(crsrRow)&&(crsrCol=0,crsrRow++):
crsrCol>=crtCols&&crsrCol--;lastChar=a},scrollDown=function(){var a;if(modeRegionOrigin){var b=regionTopRow;var d=regionBottomRow}else b=0,d=conRowAttr.length-1;expandToRow(crtRows);for(a=d;a>b;a--)conText[a]=conText[a-1],conCellAttr[a]=conCellAttr[a-1],redrawRow(a);conText[b]="";conCellAttr[b]=[];redrawRow(b);clearHotSpotsRow(d,0,999);moveHotSpotsRows(b,d-1,1)},scrollUp=function(){var a;if(modeRegionOrigin){var b=regionTopRow;var d=regionBottomRow}else b=0,d=conRowAttr.length-1;expandToRow(crtRows);
for(a=b;a<d;a++)conText[a]=conText[a+1],conCellAttr[a]=conCellAttr[a+1],redrawRow(a);conText[d]="";conCellAttr[d]=[];redrawRow(d);clearHotSpotsRow(b,0,999);moveHotSpotsRows(b+1,d,-1)},moveHotSpotsRows=function(a,b,d){var c;for(c=conHotSpots.length-1;0<=c;c--){var e=conHotSpots[c];between(e.row,a,b)&&(e.row+=d)}},moveHotSpotsRow=function(a,b,d,c){var e;for(e=conHotSpots.length-1;0<=e;e--){var f=conHotSpots[e];f.row==a&&between(f.col,b,d)&&(f.col+=c)}},clearHotSpotsRows=function(a,b){var d;for(d=conHotSpots.length-
1;0<=d;d--){var c=conHotSpots[d];between(c.row,a,b)&&conHotSpots.splice(d,1)}},clearHotSpotsRow=function(a,b,d){var c;for(c=conHotSpots.length-1;0<=c;c--){var e=conHotSpots[c];e.row==a&&e.col>=b&&e.col<=d&&conHotSpots.splice(c,1)}},conPutChar=function(a,b,d,c){expandToRow(a);expandToCol(a,b);conText[a]=conText[a].splice(b,1,String.fromCharCode(d));conCellAttr[a][b]=c;renderCell(a,b)},sendData=function(a){var b;if("string"===typeof a){var d=a;var c=d.length;a=new Uint8Array(c);for(b=0;b<c;b++)a[b]=
d.charCodeAt(b)}else"number"===typeof a&&(d=String.fromCharCode(a),a=new Uint8Array([a]));if(!(a instanceof Uint8Array))throw"Invalid data in sendData().";if(vtxdata.telnet&&0<=a.indexOf(255)){var e=[];for(b=0;0<=(c=a.indexOf(255));)e.push(a.slice(0,c)),b+=c,e.push(new Uint8Array([255,255])),b+=2,a=a.slice(c+1);b+=a.length;e.push(a);a=new Uint8Array(b);for(b=c=0;b<e.length;b++)a.set(e[b],c),c+=e[b].length}ws&&1==ws.readyState&&termState!=TS_OFFLINE?ws.send(a.buffer):(conBufferOut(d),crsrDraw())},
getUnicode=function(a,b){if("UTF8"==a)return b;var d=0,c=codePageData[a]||codePageData[codePageAKAs[a]];if(c)switch(c.length){case 256:d=c[b];break;case 128:d=128>b?codePageData.ASCII[b]:c[b-128];break;case 96:d=160>b?codePageData.ASCII[b]:c[b-160];break;default:d=codePageData.CP437[b]}return d},nop=function(){},dump=function(a,b,d){var c,e=0;var f=itoh(b,4)+":";var h="";for(c=b;c<b+d;c++)f+=" "+itoh(a[c],2),h=between(a[c],32,126)?h+String.fromCharCode(a[c]):h+".",e=e+1&15,e||(f+=": "+h+"\r\n"+itoh(c+
1,4)+":",h="");for(c=e;16>c;c++)f+="   ";console.log(f+(": "+h))},ymSendStart=function(){if(!ovl.length){fadeScreen(!0);ovl.title.innerHTML="YModem Upload";ovl.filename.innerHTML="";ovl.filesize.innerHTML="";ovl.transferred.innerHTML="";var a=domElement("input",{type:"file",onchange:ymFileLoad},{position:"relative",left:"1px",top:"1px",width:"1px",height:"1px"});ovl.dialog.appendChild(a);a.click();ovl.dialog.removeChild(a)}},cleanFileName=function(a){var b,d="";var c=0;for(b=a.length;c<b;c++){var e=
a.charAt(c);var f=a.charCodeAt(c);between(f,32,126)&&-1=='/\\?%*:|"<> '.indexOf(e)&&(d+=e)}d.length||(d="untitled");return d},ymFileLoad=function(a){var b=new FileReader;var d=a.target.files[0];name=d.name;a=name.lastIndexOf("/");-1==a&&(a=name.lastIndexOf("\\"));ymFileName=cleanFileName(name.substring(a+1));ymModifiedDate=Math.floor(d.lastModified/1E3).toString(8);ovl.filename.innerHTML=ymFileName;b.onload=ymFileLoaded;b.readAsArrayBuffer(d)},ymFileLoaded=function(a){ymFileData=new Uint8Array(a.target.result);
ymFileSize=ymFileData.byteLength;ovl.filesize.innerHTML=formatSize(ymFileSize);ovl.transferred.innerHTML=formatSize(0);termState=TS_YMS_START;ymFilePos=ymNextBlock=0;ymSendStartTime=(new Date).getTime()},ymSStateMachine=function(a){var b,d;for(d=0;d<a.length;d++){clearInterval(ymTimer);var c=a[d];switch(termState){case TS_YMS_START:if(c==_C){var e=128;ymPacketBuff=new Uint8Array(5+e);ymPacketBuff.fill(_NUL);ymPacketBuff[0]=128==e?_SOH:_STX;ymPacketBuff[1]=ymNextBlock;ymPacketBuff[2]=255-ymNextBlock;
c=ymFileName+NUL+ymFileSize.toString()+" "+ymModifiedDate+" 0 0";for(b=0;b<c.length;b++)ymPacketBuff[3+b]=c.charCodeAt(b);b=calcCRC16(ymPacketBuff,3,e);ymPacketBuff[3+e]=highByte(b);ymPacketBuff[4+e]=lowByte(b);console.log("Header Packet");dump(ymPacketBuff,0,ymPacketBuff.length);sendData(ymPacketBuff);termState=TS_YMS_PUTPACKET;ymEOTCount=ymNakCount=ymFilePos=0;ymNextBlock=ymNextBlock+1&255}else(new Date).getTime()>ymSendStartTime+1E4&&ymCancel();break;case TS_YMS_PUTWAIT:if(c==_C){ymNakCount=0;
e=1024;ymPacketBuff=new Uint8Array(5+e);ymPacketBuff.fill(_CPMEOF);ymPacketBuff[0]=128==e?_SOH:_STX;ymPacketBuff[1]=ymNextBlock;ymPacketBuff[2]=255-ymNextBlock;var f=ymFilePos;for(b=0;b<e;b++,f++)if(f<ymFileSize)ymPacketBuff[3+b]=ymFileData[f];else break;b=calcCRC16(ymPacketBuff,3,e);ymPacketBuff[3+e]=highByte(b);ymPacketBuff[4+e]=lowByte(b);sendData(ymPacketBuff);ymFilePos+=e;ymFilePos>ymFileSize&&(ymFilePos=ymFileSize);termState=TS_YMS_PUTPACKET;ymNextBlock=ymNextBlock+1&255}else break;case TS_YMS_PUTPACKET:if(c==
_NAK)sendData(ymPacketBuff),ymNakCount++,10<ymNakCount&&ymCancel();else if(c==_ACK)if(ymNakCount=0,0==ymFilePos&&1==ymNextBlock)ovl.transferred.innerHTML="Sent header.",termState=TS_YMS_PUTWAIT;else if(ymFilePos==ymFileSize)ovl.transferred.innerHTML=formatSize(ymFileSize),ymEOTCount&&(termState=TS_NORMAL,ymCancel()),ymEOTCount++,ymPacketBuff=new Uint8Array(1),ymPacketBuff[0]=_EOT,sendData(ymPacketBuff);else{ovl.transferred.innerHTML=formatSize(ymFilePos);e=1024;ymPacketBuff=new Uint8Array(5+e);ymPacketBuff.fill(_CPMEOF);
ymPacketBuff[0]=128==e?_SOH:_STX;ymPacketBuff[1]=ymNextBlock;ymPacketBuff[2]=255-ymNextBlock;f=ymFilePos;for(b=0;b<e;b++,f++)if(f<ymFileSize)ymPacketBuff[3+b]=ymFileData[f];else break;b=calcCRC16(ymPacketBuff,3,e);ymPacketBuff[3+e]=highByte(b);ymPacketBuff[4+e]=lowByte(b);sendData(ymPacketBuff);ymFilePos+=e;ymFilePos>ymFileSize&&(ymFilePos=ymFileSize);ymNextBlock=ymNextBlock+1&255}else c==_CAN&&ymCancel()}if(termState==TS_NORMAL)break}return[]},lowByte=function(a){return a&255},highByte=function(a){return a>>>
8&255},twosCompliment=function(a){return 255-a&255},ymTimeOut=function(){sendData(ymPacketBuff);ymNakCount++},ymRecvStart=function(){ovl.length||(termState=TS_YMR_START,fadeScreen(!0),ovl.title.innerHTML="YModem Download",ovl.filename.innerHTML="Waiting for Remote...",ovl.filesize.innerHTML="",ovl.transferred.innerHTML="",ymCCount=ymNextBlock=0,ymSendC(),termState!=TS_NORMAL&&(ymTimer=setInterval(ymSendC,3E3)))},ymSendC=function(){sendData(_C);ymCCount++;8<ymCCount&&(termState=TS_NORMAL,clearInterval(ymTimer),
fadeScreen(!1))},ymCancel=function(){clearInterval(ymTimer);sendData(_CAN);sendData(_CAN);sendData(_CAN);sendData(_CAN);sendData(_CAN);sendData(_CAN);sendData(_CAN);sendData(_CAN);termState=TS_NORMAL;fadeScreen(!1)},formatSize=function(a){var b;for(b=0;1E3<=a;a/=1E3,b++);return a.toFixed(2)+" "+["B","KB","MB","GB"][b]},ymRStateMachine=function(a){var b,d=[];if(!a)return d;for(b=0;b<a.length;b++){var c=a[b];switch(termState){case TS_YMR_START:ymPacketPos=0;switch(c){case _SOH:clearInterval(ymTimer);
ymEOTCount=0;termState=TS_YMR_GETPACKET;ymPacketSize=132;break;case _STX:clearInterval(ymTimer);ymEOTCount=0;termState=TS_YMR_GETPACKET;ymPacketSize=1028;break;case _EOT:clearInterval(ymTimer);ymEOTCount++;if(1==ymEOTCount){sendData(_ACK);termState=TS_NORMAL;fadeScreen(!1);if(-1<ymFileSize)ymFileData=ymFileData.slice(0,ymFileSize);else throw"EOT look for CMPEOF";saveAs(ymFileData,ymFileName);d=a.slice(b+1);ymCancel();break}sendData(_ACK);break;case _CAN:clearInterval(ymTimer),ymEOTCount=0,termState=
TS_NORMAL,fadeScreen(!1),ymFileData=new Blob([],{type:"application/octet-stream"}),d=a.slice(b+1)}break;case TS_YMR_GETPACKET:if(ymPacketBuff[ymPacketPos++]=c,ymPacketPos==ymPacketSize){c=ymPacketBuff[0];var e=ymPacketBuff[1];if(c!=ymNextBlock)c==ymNextBlock-1?sendData(_ACK):sendData(_NAK),termState=TS_YMR_START;else if(c!=(~e&255))sendData(_NAK),termState=TS_YMR_START;else{e=ymPacketBuff[ymPacketPos-2]<<8|ymPacketBuff[ymPacketPos-1];var f=calcCRC16(ymPacketBuff,2,ymPacketSize-4);if(e!=f)sendData(_NAK),
termState=TS_YMR_START;else{if(0==c&&0==ymFileData.size){ymFileName="";for(e=2;ymPacketBuff[e];)ymFileName+=String.fromCharCode(ymPacketBuff[e++]);ovl.filename.innerHTML=ymFileName;e++;if(ymPacketBuff[e]){for(f="";ymPacketBuff[e]!=_SPACE&&ymPacketBuff[e]!=_NUL;)f+=String.fromCharCode(ymPacketBuff[e++]);ymFileSize=int(f);ovl.filesize.innerHTML=formatSize(ymFileSize)}else ymFileSize=-1,ovl.filesize.innerHTML="Unknown";ymFileData=new Blob([],{type:"application/octet-stream"});ovl.transferred.innerHTML=
"0 bytes";sendData(_ACK);sendData(_C)}else{f=new Uint8Array(ymPacketSize-4);for(e=0;e<ymPacketSize-4;e++)f[e]=ymPacketBuff[2+e];ymPacketBuff=[];ymFileData=e=new Blob([ymFileData,f]);ovl.transferred.innerHTML=formatSize(ymFileData.size);sendData(_ACK)}termState=TS_YMR_START;ymNextBlock=c+1&255}}}}if(termState==TS_NORMAL)break}return d},saveAs=function(a,b){var d=window.URL.createObjectURL(a);var c=domElement("a",{href:d,download:b},{display:"none"});document.body.appendChild(c);c.click();document.body.removeChild(c);
setTimeout(function(){window.URL.revokeObjectURL(d)},1E3)},combineArrays=function(a,b){var d=a.length,c=new Uint8Array(d+b.length);c.set(a);c.set(b,d);return c},calcCRC16=function(a,b,d){var c=0;var e=b;for(b+=d;e<b;e++)c=updateCRC16(c,a[e]);c=updateCRC16(c,0);c=updateCRC16(c,0);return c&65535},updateCRC16=function(a,b){var d=a,c=b|256;do d<<=1,c<<=1,c&256&&d++,d&65536&&(d^=CRC_POLY);while(!(c&65536));return d&65535},fadeScreen=function(a){a?(pageDiv.classList.add("fade"),ovl.dialog=domElement("div",
{className:"noselect"},{width:"256px",height:"128px",display:"block",background:"#CCC",color:"#000",border:"2px outset #888",position:"fixed",top:(window.innerHeight-128)/2+"px",left:(pageWidth-256)/2+"px",cursor:"default",fontFamily:"san-serif",fontSize:"12px"}),document.body.appendChild(ovl.dialog),ovl.dialog.appendChild(domElement("input",{type:"button",onclick:ymCancel,value:"Cancel"},{width:"96px",height:"24px",position:"absolute",bottom:"8px",right:"8px"})),ovl.title=domElement("span",{className:"noselect"},
{width:"228px",height:"20px",background:"#039",border:"1px inset #888",position:"absolute",top:"4px",left:"4px",padding:"0px 8px",fontSize:"14px",fontWieght:"bold",color:"white"},"YModem Download"),ovl.dialog.appendChild(ovl.title),ovl.dialog.appendChild(domElement("span",{className:"noselect"},{position:"absolute",top:"32px",left:"12px"},"File:")),ovl.filename=domElement("span",{},{position:"absolute",top:"32px",left:"80px",width:"172px",overflow:"hidden",textOverflow:"ellipsis"},"{filename}"),ovl.dialog.appendChild(ovl.filename),
ovl.dialog.appendChild(domElement("span",{className:"noselect"},{position:"absolute",top:"52px",left:"12px"},"Size:")),ovl.filesize=domElement("span",{},{position:"absolute",top:"52px",left:"80px",width:"172px",overflow:"hidden",textOverflow:"ellipsis"},"{filesize}"),ovl.dialog.appendChild(ovl.filesize),ovl.dialog.appendChild(domElement("span",{className:"noselect"},{position:"absolute",top:"72px",left:"12px"},"Transferred:")),ovl.transferred=domElement("span",{},{position:"absolute",top:"72px",left:"80px",
width:"172px",overflow:"hidden",textOverflow:"ellipsis"},"{transferred}"),ovl.dialog.appendChild(ovl.transferred),setBulbs(),document.getElementById("ulbtn").style.visibility="hidden",document.getElementById("dlbtn").style.visibility="hidden",setTimers(!1),document.body.style.cursor="wait"):(pageDiv.classList.remove("fade"),ovl.dialog&&document.body.removeChild(ovl.dialog),ovl={},document.getElementById("ulbtn").style.visibility="visible",document.getElementById("dlbtn").style.visibility="visible",
setTimers(!0),document.body.style.cursor="default")},UFT8ArrayToStr=function(a){var b;var d="";var c=a.length;for(b=0;b<c;){var e=a[b++];switch(e>>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(e);break;case 12:case 13:var f=a[b++];d+=String.fromCharCode((e&31)<<6|f&63);break;case 14:f=a[b++];var h=a[b++];d+=String.fromCharCode((e&15)<<12|(f&63)<<6|(h&63)<<0)}}return d},initDisplay=function(){var a;hotspotHoverAttr=524543;hotspotClickAttr=255;if(pageDiv=document.getElementById("vtxpage"))if(textDiv=
document.getElementById("vtxtext")){getDefaultFontSize();crtWidth=colSize*crtCols;codePageData[codePage]||codePageAKAs[codePage]&&(codePage=codePageAKAs[codePage]);if(cbm){conFontNum=0;switch(vtxdata.codePage){case "VIC20":conFont[0]="VIC200";conFont[1]="VIC201";cbmColors=vic20Colors;break;case "C64":conFont[0]="C640";conFont[1]="C641";cbmColors=c64Colors;break;case "C128":conFont[0]="C1280",conFont[1]="C1281",cbmColors=c128Colors}conFontCP[0]="RAW";conFontCP[1]="RAW"}else if(atari)conFontNum=0,conFont[0]=
"ATARI",conFontCP[0]="RAW";else{for(a=conFontNum=0;10>a;a++)conFont[a]=fontName,conFontCP[a]=codePage;for(a=10;13>a;a++)conFont[a]=fontName,conFontCP[a]="TELETEXT"}pageDiv.style.width=crtWidth*xScale+"px";pagePos=getElementPosition(pageDiv);pageLeft=pagePos.left;pageTop=pagePos.top;a=document.createElement("style");a.type="text/css";var b=".marquee { animation: marquee 12s linear infinite; } @keyframes marquee { 0% { transform: translate( "+xScale*crtCols*colSize+"px, 0); } 100% { transform: translate(-100%, 0); }}";
a.styleSheet?a.styleSheet.cssText=b:a.appendChild(document.createTextNode(b));(document.head||document.getElementsByTagName("head")[0]).appendChild(a);defCellAttr=vtxdata.defCellAttr;defCrsrAttr=vtxdata.defCrsrAttr;defPageAttr=vtxdata.defPageAttr;cellAttr=defCellAttr;crsrAttr=defCrsrAttr;pageAttr=defPageAttr;newCrsr();crsrSkipTime=0;soundBell=new Audio;soundBell.src="bell.mp3";soundBell.type="audio/mp3";soundBell.volume=1;soundBell.preload="auto";soundBell.load();a=pageDiv.parentNode;cbm?(a.style["background-color"]=
cbmColors[pageAttr>>>8&15],pageDiv.style["background-color"]=cbmColors[pageAttr&15]):atari?(a.style["background-color"]=atariColors[pageAttr>>>8&1],pageDiv.style["background-color"]=atariColors[pageAttr&1]):(a.style["background-color"]=ansiColors[pageAttr>>>8&255],pageDiv.style["background-color"]=ansiColors[pageAttr&255]);pageWidth=elPage.clientWidth;crsrBlink=shiftState=ctrlState=altState=capState=numState=scrState=!1;cellBlinkFast=cellBlinkSlow=!0;crsrRow=crsrCol=0;crsrDraw();elPage=document.getElementsByTagName("html")[0];
setTimers(!0);crsrRow=crsrCol=0;textPos=textDiv.getBoundingClientRect();termState=TS_OFFLINE;ctrlDiv=domElement("div",{id:"ctrls"},{width:"24px",height:"164px",position:"fixed",top:textPos.top+"px",left:6+textPos.left+crtWidth*xScale+"px"});ctrlDiv.appendChild(domElement("img",{src:"os0.png",id:"osbulb",onclick:termConnect,width:24,height:24,title:"Connect/Disconnect"},{cursor:"pointer"}));ctrlDiv.appendChild(domElement("img",{src:"cl0.png",id:"clbulb",width:24,height:24,title:"CapsLk"}));ctrlDiv.appendChild(domElement("img",
{src:"nl0.png",id:"nlbulb",width:24,height:24,title:"NumLk"}));ctrlDiv.appendChild(domElement("img",{src:"sl0.png",id:"slbulb",width:24,height:24,title:"ScrLk"}));ctrlDiv.appendChild(domElement("img",{src:"ul0.png",id:"ulbtn",onclick:ymSendStart,width:24,height:24,title:"YModem Upload"},{cursor:"pointer"}));ctrlDiv.appendChild(domElement("img",{src:"dl0.png",id:"dlbtn",onclick:ymRecvStart,width:24,height:24,title:"YModem Download"},{cursor:"pointer"}));pageDiv.appendChild(ctrlDiv);audio=domElement("audio",
{id:"vtxaudio",preload:"none",volume:"0.25",src:"/;"},{width:"0px",height:"0px"});pageDiv.appendChild(audio);conBufferOut(initStr);if(vtxdata.autoConnect&&0<vtxdata.autoConnect)termConnect();else switch(vtxdata.term){case "PETSCII":conStrOut("\u000evtx tERMINAL cLIENT\r");conStrOut("vERSION 0.9\r");conStrOut("2017 dAN mECKLENBURG jR.\r");conStrOut("GITHUB.COM/CODEWAR65/vtx\u00a4cLIENTsERVER\r");conStrOut("\rcLICK cONNECT...\r");break;case "ATASCII":conStrOut("VTX Terminal Client\u009b");conStrOut("Version 0.9\u009b");
conStrOut("2017 Dan Mecklenburg Jr.\u009b");conStrOut("github.com/codewar65/VTX_ClientServer\u009b");conStrOut("\u009bClick Connect...\u009b");break;default:conStrOut("\n\r\u001b#6\u001b[38;5;46;58mVTX\u001b[32;78m Terminal Client\n\r"),conStrOut("\u001b#6\u001b[38;5;46;59mVTX\u001b[32;79m Version 0.9 Beta\n\r"),conStrOut("\n\r\u001b[m2017 Dan Mecklenburg Jr.\n\r"),conStrOut("Visit \u001b[1;45;1;1;"+encodeAscii("https://github.com/codewar65/VTX_ClientServer")+"\\https://github.com/codewar65/VTX_ClientServer for more info.\n\r"),
conStrOut("\n\r\u001b[38;5;46mCLICK CONNECT...\u001b[m\n\r")}setBulbs();addListener(document,"keydown",keyDown);addListener(document,"keyup",keyUp);addListener(document,"keypress",keyPress);addListener(document,"mouseup",mouseUp);addListener(document,"mousedown",mouseDown);addListener(document,"click",click);addListener(document,"mousemove",mouseMove);addListener(document,"beforepaste",beforePaste);addListener(document,"paste",paste)}},encodeAscii=function(a){var b,d="";var c=a.length;for(b=0;b<c;b++)d+=
";"+a.charCodeAt(b).toString();return d.substring(1)},termConnect=function(){termState==TS_OFFLINE?(tnState=0,ws=new WebSocket(wsConnect,["telnet"]),ws.binaryType="arraybuffer",ws.onmessage=function(a){var b=new Uint8Array(a.data);1==vtxdata.telnet&&(b=tnNegotiate(b));switch(termState){case TS_NORMAL:switch(codePage){case "UTF8":var d=UFT8ArrayToStr(b);break;case "UTF16":d=b.toString();break;default:for(d="",a=0;a<b.length;a++)d+=String.fromCharCode(b[a])}conBufferOut(d);break;case TS_YMR_START:case TS_YMR_GETPACKET:b=
ymRStateMachine(b);0<b.length&&conBufferOut(d);break;case TS_YMS_START:case TS_YMS_PUTPACKET:case TS_YMS_PUTWAIT:b=ymSStateMachine(b),0<b.length&&conBufferOut(d)}},ws.onopen=function(){vtxdata.telnet&&tnInit();termState=TS_NORMAL;setBulbs()},ws.onclose=function(){conBaud=0;cbm?conBufferOut("\r\rDISCONNECTED.\r"):atari?conBufferOut("\u009b\u009bDisconnected.\u009b"):conBufferOut("\r\n\r\n\u001b[#9\u001b[0;91mDisconnected.\r\n");document.body.style.cursor="default";audio&&(audio.pause(),pageDiv.removeChild(audio));
termState=TS_OFFLINE;setBulbs()},ws.onerror=function(a){cbm?conBufferOut("\r\rERROR : "+a.reason.toUpper()+"\r"):atari?conBufferOut("\u009b\u009bError : "+a.reason()+"\tB"):conBufferOut("\r\n\r\n\u001b[#9\u001b[0;91mError : "+a.reason+"\r\n");setBulbs()}):ws.close()},newCrsr=function(){var a=["0%","10%","25%","100%"];if(null==crsr){crsr=domElement("div",{},{position:"absolute",display:"block",zIndex:"999"});var b=domElement("div",{id:"crsr"},{position:"absolute",display:"block",bottom:"0px",left:"0px"});
crsr.appendChild(b);textDiv.appendChild(crsr)}else b=crsr.firstChild;var d=getCrsrAttrOrientation(crsrAttr);var c=getCrsrAttrSize(crsrAttr);switch(d){case 0:b.style.width="100%";b.style.height=a[c];break;default:b.style.height="100%",b.style.width=a[c]}a=getCrsrAttrColor(crsrAttr);b.style["background-color"]=cbm?cbmColors[a&15]:atari?atariColors[a&1]:ansiColors[a]},paste=function(a){a=a||window.event;a.stopPropagation();a.preventDefault();conBufferOut((a.clipboardData||window.clipboardData).getData("Text"))},
beforePaste=function(a){a.returnValue=!1},setTimers=function(a){a?(null==irqWriteBuffer&&(irqWriteBuffer=setInterval(doWriteBuffer,33)),null==irqCheckResize&&(irqCheckResize=setInterval(doCheckResize,10)),null==irqCursor&&(irqCursor=setInterval(doCursor,533)),null==irqBlink&&(irqBlink=setInterval(doBlink,533))):(null!=irqWriteBuffer&&clearInterval(irqWriteBuffer),null!=irqCheckResize&&clearInterval(irqCheckResize),null!=irqCursor&&clearInterval(irqCursor),null!=irqBlink&&clearInterval(irqBlink),irqBlink=
irqCursor=irqCheckResize=irqWriteBuffer=null)},setBulbs=function(){var a=document.getElementById("osbulb");termState==TS_OFFLINE?(a.src="os0.png",a.title="Connect"):(a.src="os1.png",a.title="Disconnect");document.getElementById("clbulb").src=(capState?"cl1":"cl0")+".png";document.getElementById("nlbulb").src=(numState?"nl1":"nl0")+".png";document.getElementById("slbulb").src=(scrState?"sl1":"sl0")+".png";termState==TS_NORMAL?(a=document.getElementById("ulbtn"),a.src="ul1.png",a.style.visibility="visible",
a=document.getElementById("dlbtn"),a.src="dl1.png",a.style.visibility="visible"):termState==TS_OFFLINE?(a=document.getElementById("ulbtn"),a.src="ul0.png",a.style.visibility="visible",a=document.getElementById("dlbtn"),a.src="dl0.png",a.style.visibility="visible"):(document.getElementById("ulbtn").style.visibility="hidden",document.getElementById("dlbtn").style.visibility="hidden")},fitSVGToDiv=function(a){var b=this.parentNode.getBoundingClientRect();a=b.width;b=b.height;var d=this.naturalWidth;
var c=this.naturalHeight;this.style["transform-origin"]="top left";this.style.transform="scale("+a/c+","+b/d+")";this.style.visibility="visible"},expandToRow=function(a){if(a>=conRowAttr.length){for(;a>getMaxRow();)textDiv.appendChild(createNewRow()),conRowAttr[conRowAttr.length]=2883584,conCellAttr[conCellAttr.length]=[],conText[conText.length]="";trimHistory()}},expandToCol=function(a,b){for(;conText[a].length<b;)conText[a]+=" ";for(;conCellAttr[a].length<b;)conCellAttr[a][conCellAttr[a].length]=
defCellAttr},brightenRGB=function(a,b){if("transparent"==a)return a;var d=htoi(a.substring(1));var c=d>>>16&255;var e=d>>>8&255;d&=255;0>b?(b+=1,c*=b,e*=b,d*=b):(c=(255-c)*b+c,e=(255-e)*b+e,d=(255-d)*b+d);c=Math.floor(c)&255;e=Math.floor(e)&255;d=Math.floor(d)&255;return"#"+itoh((c<<16)+(e<<8)+d,6)},drawMosaicBlock=function(a,b,d,c,e){var f,h,k=1,m=Math.floor(d/2),g=Math.floor(c/3),l,r=0;e=e?-1:0;d-=2*m;c-=3*g;b-=32;31<b&&(b-=32);for(h=0;3>h;h++){for(f=l=0;2>f;f++)b&k&&a.fillRect(l,r,m+(f?d:0)+e,
g+(2==h?c:0)+e),l+=m,k<<=1;r+=g}},renderCell=function(a,b,d,c){d=(void 0===d?0:d)||0;var e=(c=(void 0===c?!1:c)||!1)?-1:0;if(!(a+e>conRowAttr.length||b>=conText[a+e].length)){var f=getRowAttrHeight(conRowAttr[a+e])/100;var h=getRowAttrWidth(conRowAttr[a+e])/100;var k=xScale*colSize*h;var m=k*b;if(!(m>k*crtCols)||conRowAttr[a]&A_ROW_MARQUEE){var g=getRowElement(a);var l=fontSize*f;var r=.1*l;var p=g.firstChild;p||(p=domElement("canvas",{width:crtCols*k,height:l+16},{zIndex:"50"}),g.appendChild(p));
g=p.getContext("2d");p=conText[a+e].charAt(b);b=conCellAttr[a+e][b];1==d?b=hotspotHoverAttr:2==d&&(b=hotspotClickAttr);d=b&255;var n=b>>>8&255;e=(b&A_CELL_FONT_MASK)>>>28&15;var q=b&A_CELL_BOLD;modeNoBold&&(q=0);var v=b&(A_CELL_BLINKSLOW|A_CELL_BLINKFAST);modeBoldFont&&q&&(e=1);modeBlinkFont&&v&&(e=2);modeBoldFont&&q&&modeBlinkFont&&v&&(e=3);if(b&A_CELL_REVERSE){var w=d;d=n;n=w}cbm||atari||modeVTXANSI||(q&&8>d&&(d+=8),q=!1);modeBlinkBright&&8>n&&v&&(n+=8,b&=~(A_CELL_BLINKSLOW|A_CELL_BLINKFAST));cbm||
atari||(0==d&&(d=16),0!=n||modeVTXANSI||(n=16));9608==p.charCodeAt(0)&&(p=" ",n=d);g.save();g.beginPath();g.rect(m,0,k,l);g.clip();cbm?(g.fillStyle=cbmColors[n],g.fillRect(m,0,k,l)):atari?(g.fillStyle=atariColors[n],g.fillRect(m,0,k,l)):0<n?(g.fillStyle=ansiColors[n],g.fillRect(m,0,k,l)):g.clearRect(m,0,k,l);n=!0;if(b&A_CELL_BLINKSLOW&&cellBlinkSlow||b&A_CELL_BLINKFAST&&cellBlinkFast)modeNoBlink||(n=!1);switch(conRowAttr[a]&A_ROW_DISPLAY_MASK){case A_ROW_DISPLAY_NORMAL:a=b&A_CELL_DISPLAY_MASK;switch(a){case A_CELL_DISPLAY_NORMAL:var t=
0;var u=1;break;case A_CELL_DISPLAY_CONCEAL:n=!1;break;case A_CELL_DISPLAY_TOP:t=0;u=2;break;case A_CELL_DISPLAY_BOTTOM:t=-l,u=2}break;case A_ROW_DISPLAY_CONCEAL:n=!1;break;case A_ROW_DISPLAY_TOP:t=0;u=2;break;case A_ROW_DISPLAY_BOTTOM:t=-l,u=2}if(n){g.fillStyle=b&A_CELL_FAINT?brightenRGB(ansiColors[d],-.33):cbm?cbmColors[d]:atari?atariColors[d]:ansiColors[d];a=-1;if(11==e||12==e){if(" "<=p&&"?">=p||"`"<=p&&"\u007f">=p)a=e-11;g.font=(q?"bold ":"")+fontSize+"px "+conFont[e]}else g.font=cbm?(q?"bold ":
"")+fontSize+"px "+conFont[conFontNum]:(q?"bold ":"")+fontSize+"px "+conFont[e];g.textAlign="start";g.textBaseline="top";b&A_CELL_SHADOW&&(g.shadowColor="#000000",g.shadowOffsetX=l/rowSize,g.shadowOffsetY=l/rowSize);n=q=g.shadowBlur=0;b&A_CELL_ITALICS&&(q=-.125,n=1);c&&(t=-l,u=2);-1==a&&(p=String.fromCharCode(getUnicode(conFontCP[e],p.charCodeAt(0))));g.setTransform(xScale*h,0,xScale*q,u*f,m+xScale*n,t);b&A_CELL_OUTLINE?(g.strokeStyle=ansiColors[d],g.lineWidth=1,g.strokeText(p,0,0)):0<=a?drawMosaicBlock(g,
p.charCodeAt(0),k/h,l,a):g.fillText(p,0,0);b&A_CELL_UNDERLINE&&g.fillRect(0,l-r,k,r);b&A_CELL_STRIKETHROUGH&&g.fillRect(0,(l+r)/2,k,r)}g.restore()}}},renderAll=function(){var a,b;for(a=0;a<conRowAttr.length;a++)for(b=0;b<conCellAttr[a].length;b++)renderCell(a,b)},redrawRow=function(a){var b;expandToRow(a);var d=conText[a].length;for(b=0;b<d;b++)renderCell(a,b);b=getRowElement(a);var c=getRowAttrHeight(conRowAttr[a])/100;a=getRowAttrWidth(conRowAttr[a])/100;a*=xScale*colSize;c*=fontSize;var e=a*d;
d=b.firstChild;d||(d=domElement("canvas",{width:crtCols*a,height:c+16},{zIndex:"50"}),b.appendChild(d));d.getContext("2d").clearRect(e,0,d.width-e,d.height)},adjustRow=function(a){var b=getRowElement(a);var d=getRowAttrHeight(conRowAttr[a])/100;var c=getRowAttrWidth(conRowAttr[a])/100;var e=rowSize*d;var f=colSize*c;c=b.firstChild;c||(c=document.createElement("canvas"),b.appendChild(c));f=conRowAttr[a]&A_ROW_MARQUEE?Math.max(conText[a].length*f,crtCols*colSize):crtCols*colSize;if(c.height!=e+16||
c.width!=f)b.style.height=d+"em",c.width=f*xScale,c.height=e+16;redrawRow(a)},getCrsrAttrOrientation=function(a){return(a&A_CRSR_ORIENTATION)>>>10},getCrsrAttrSize=function(a){return(a&A_CRSR_STYLE_MASK)>>>8},getCrsrAttrColor=function(a){return a&255},setCrsrAttrOrientation=function(a,b){return a&~A_CRSR_ORIENTATION|(b?A_CRSR_ORIENTATION:0)},setCrsrAttrSize=function(a,b){return a&~A_CRSR_STYLE_MASK|b<<8&768},setCrsrAttrColor=function(a,b){return a&~A_CRSR_COLOR_MASK|b&255},makeCrsrAttr=function(a,
b,d){return(a||7)&255|((b||2)&3)<<8|(d?1:0)<<10},getCellAttrFont=function(a){return(a&A_CELL_FONT_MASK)>>>28},getCellAttrFaint=function(a){return 0!=(a&A_CELL_FAINT)},getCellAttrDisplay=function(a){return a&A_CELL_DISPLAY_MASK},getCellAttrReverse=function(a){return 0!=(a&A_CELL_REVERSE)},getCellAttrOutline=function(a){return 0!=(a&A_CELL_OUTLINE)},getCellAttrStrikethrough=function(a){return 0!=(a&A_CELL_STRIKETHROUGH)},getCellAttrShadow=function(a){return 0!=(a&A_CELL_SHADOW)},getCellAttrBlinkFast=
function(a){return 0!=(a&A_CELL_BLINKFAST)},getCellAttrBlinkSlow=function(a){return 0!=(a&A_CELL_BLINKSLOW)},getCellAttrUnderline=function(a){return 0!=(a&A_CELL_UNDERLINE)},getCellAttrItalics=function(a){return 0!=(a&A_CELL_ITALICS)},getCellAttrBold=function(a){return 0!=(a&A_CELL_BOLD)},getCellAttrBG=function(a){return a>>>8&255},getCellAttrFG=function(a){return a&255},setCellAttrFont=function(a,b){return a&~A_CELL_FONT_MASK|(b&15)<<28},setCellAttrFaint=function(a,b){return a&~A_CELL_FAINT|(b?A_CELL_FAINT:
0)},setCellAttrDisplay=function(a,b){return a&~A_CELL_DISPLAY_MASK|b&A_CELL_DISPLAY_MASK},setCellAttrReverse=function(a,b){return a&~A_CELL_REVERSE|(b?A_CELL_REVERSE:0)},setCellAttrOutline=function(a,b){return a&~A_CELL_OUTLINE|(b?A_CELL_OUTLINE:0)},setCellAttrStrikethrough=function(a,b){return a&~A_CELL_STRIKETHROUGH|(b?A_CELL_STRIKETHROUGH:0)},setCellAttrShadow=function(a,b){return a&~A_CELL_SHADOW|(b?A_CELL_SHADOW:0)},setCellAttrBlinkFast=function(a,b){return a&~A_CELL_BLINKFAST|(b?A_CELL_BLINKFAST:
0)},setCellAttrBlinkSlow=function(a,b){return a&~A_CELL_BLINKSLOW|(b?A_CELL_BLINKSLOW:0)},setCellAttrUnderline=function(a,b){return a&~A_CELL_UNDERLINE|(b?A_CELL_UNDERLINE:0)},setCellAttrItalics=function(a,b){return a&~A_CELL_ITALICS|(b?A_CELL_ITALICS:0)},setCellAttrBold=function(a,b){return a&~A_CELL_BOLD|(b?A_CELL_BOLD:0)},setCellAttrBG=function(a,b){return a&~A_CELL_BGCOLOR_MASK|(b&255)<<8},setCellAttrFG=function(a,b){return a&~A_CELL_FGCOLOR_MASK|b&255},makeCellAttr=function(a,b,d,c,e,f,h,k,m,
g,l,r){return(void 0===a?7:a)&255|((void 0===b?0:b)&255)<<8|((void 0===d?0:d)?A_CELL_BOLD:0)|((void 0===c?0:c)?A_CELL_ITALICS:0)|((void 0===e?0:e)?A_CELL_UNDERLINE:0)|((void 0===f?0:f)?A_CELL_BLINKSLOW:0)|((void 0===h?0:h)?A_CELL_SHADOW:0)|((void 0===k?0:k)?A_CELL_STRIKETHROUGH:0)|((void 0===m?0:m)?A_CELL_OUTLINE:0)|((void 0===g?0:g)?A_CELL_BLINKFAST:0)|((void 0===l?0:l)?A_CELL_FAINT:0)|((void 0===r?0:r)&15)<<28},getRowAttrMarquee=function(a){return 0!=(a&A_ROW_MARQUEE)},getRowAttrWidth=function(a){return 50*
(((a&A_ROW_WIDTH_MASK)>>>21)+1)},getRowAttrHeight=function(a){return 25*(((a&A_ROW_HEIGHT_MASK)>>>18)+1)},getRowAttrPattern=function(a){return a&A_ROW_PATTERN_MASK},getRowAttrColor2=function(a){return a>>>8&255},getRowAttrColor1=function(a){return a&255},setRowAttrMarquee=function(a,b){return a&~A_ROW_MARQUEE|(b?A_ROW_MARQUEE:0)},setRowAttrWidth=function(a,b){b=Math.round(b/50)-1;0>b&&(b=0);3<b&&(b=3);return a&~A_ROW_WIDTH_MASK|b<<21},setRowAttrHeight=function(a,b){b=Math.round(b/25)-1;0>b&&(b=0);
7<b&&(b=7);return a&~A_ROW_HEIGHT_MASK|b<<18},setRowAttrPattern=function(a,b){return a&~A_ROW_PATTERN_MASK|b},setRowAttrColor2=function(a,b){return a&~A_ROW_COLOR2_MASK|(b&255)<<8},setRowAttrColor1=function(a,b){return a&~A_ROW_COLOR1_MASK|b&255},setPageAttrBackground=function(a,b){return a&65280|b&255},setPageAttrBorder=function(a,b){return a&255|(b&255)<<8},makeRowAttr=function(a,b,d,c,e,f){d=void 0===d?0:d;e=void 0===e?100:e;f=void 0===f?!1:f;minMax(Math.round((void 0===c?100:c)/25)-1,0,7);e=minMax(Math.round(e/
50)-1,0,3)<<21;return a&255|(b&255)<<8|d|size|e|(f?A_ROW_MARQUEE:0)},htoi=function(a){var b,d;a=(a||"0").toUpperCase();var c=d=0;for(b=a.length;c<b;c++)d<<=4,d+=hex.indexOf(a.charAt(c));return d},itoh=function(a,b){var d="";for(b=b||0;a;d=hex.charAt(a&15)+d,a>>=4);if(0<b)for(;d.length<b;)d="0"+d;return d},getRowFontSize=function(a){var b=conRowAttr[a];a=colSize*(getRowAttrWidth(b)/100);b=rowSize*(getRowAttrHeight(b)/100);return{width:a,height:b}},doBlink=function(){var a,b;if(!modeNoBlink&&!modeBlinkBright){var d=
textDiv.getBoundingClientRect().top;for(a=0;a<conRowAttr.length;a++){var c=rowSize*getRowAttrHeight(conRowAttr[a])/100;if(0<d+c&&d<window.innerHeight)for(b=0;b<conCellAttr[a].length;b++)conCellAttr[a][b]&(A_CELL_BLINKSLOW|A_CELL_BLINKFAST)&&renderCell(a,b);d+=c}}(cellBlinkFast=!cellBlinkFast)&&(cellBlinkSlow=!cellBlinkSlow)},doCursor=function(){crsr.firstChild.style["background-color"]=cbm?(crsrBlink=!crsrBlink)||!modeCursor?"transparent":cbmColors[cellAttr&15]:atari?(crsrBlink=!crsrBlink)||!modeCursor?
"transparent":atariColors[cellAttr&1]:(crsrBlink=!crsrBlink)||!modeCursor?"transparent":ansiColors[getCrsrAttrColor(crsrAttr)]},doCheckResize=function(){textPos=textDiv.getBoundingClientRect();elPage.clientWidth!=pageWidth&&(pageWidth=elPage.clientWidth,crsrDraw(!0));ctrlDiv.style.left=6+textPos.left+crtWidth*xScale+"px"},getRowElement=function(a){var b=document.getElementsByClassName("vtx");return a>b.length?null:b[a]},XcrsrRight=function(){crsrCol++;crsrDraw()},XcrsrLeft=function(){0<crsrCol&&crsrCol--;
crsrDraw()},XcrsrUp=function(){0<crsrRow&&crsrRow--;crsrDraw()},XcrsrMove=function(a,b){crsrRow=a;crsrCol=b;crsrDraw()},XcrsrHome=function(){crsrRow=crsrCol=0;crsrDraw()},getMaxCol=function(a){return conText[a].length-1},getMaxRow=function(){return conRowAttr.length-1},getDefaultFontSize=function(){var a,b,d,c;var e="\u2588\u2584\u2580\u2590\u258c\u2591\u2592\u2593";for(a=32;128>a;a++)e+=String.fromCharCode(a);e+="\u2588\u2584\u2580\u2590\u258c\u2591\u2592\u2593";a=document.defaultView.getComputedStyle(pageDiv,
null);fontName=a["font-family"];fontSize=int(a["font-size"]);a=fontSize+"px "+fontName;var f=domElement("canvas",{width:2E3,height:64}).getContext("2d");f.font=a;f.textBaseline="top";f.textAlign="left";f.fillStyle="#FFF";f.fillText(e,0,0);var h=f.getImageData(0,0,2E3,64).data;var k=d=2E3;for(f=c=b=0;64>f;f++)for(a=0;2E3>a;a++){var m=h[4*(2E3*f+a)];0!=m&&(f<k&&(k=f),f>b&&(b=f),a<d&&(d=a),a>c&&(c=a))}colSize=Math.round((c-d)/e.length-.25);rowSize=Math.floor(b-k)+1},crsrDraw=function(a){expandToRow(crsrRow);
a=getRowElement(crsrRow);if(null!=a){a=getElementPosition(a);var b=document.documentElement.scrollTop||document.body.scrollTop;var d="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight;var c=getRowFontSize(crsrRow);crsr.style.top=a.top-pageTop+"px";crsr.style.left=xScale*crsrCol*c.width+"px";crsr.style.width=xScale*c.width+"px";crsr.style.height=c.height+"px";a.top<b?window.scrollTo(0,a.top-8):a.top+c.height>b+d&&window.scrollTo(0,a.top+c.height+8)}},getElementPosition=
function(a){for(var b=a.offsetLeft,d=a.offsetTop;a.offsetParent;)a=a.offsetParent,b+=a.offsetLeft,d+=a.offsetTop;return{left:b,top:d}},fixParams=function(a,b){var d;for(d=a.length;d<b.length;d++)a[d]=b[d];return a.slice(0,b.length)},colsOnRow=function(a){var b=crtCols;a=getRowAttrWidth(conRowAttr[a])/100;return 1/a*b},createNewRow=function(){var a=domElement("div",{className:"vtx"});domElement("canvas");return a},insChar=function(a,b,d){expandToRow(a);expandToCol(a,b);conText[a]=conText[a].splice(b,
0,String.fromCharCode(d));conCellAttr[a].splice(b,0,defCellAttr);moveHotSpotsRow(a,b,999,1);redrawRow(a)},delChar=function(a,b){expandToRow(a);expandToCol(a,b);conText[a]=conText[a].splice(b,1);conCellAttr[a].splice(b,1);moveHotSpotsRow(a,b,999,-1);redrawRow(a)},trimHistory=function(){for(var a,b;conRowAttr.length>vtxdata.crtHistory;)clearHotSpotsRow(0,0,999),a=document.getElementsByClassName("vtx"),b=a[0].parentNode,b.removeChild(a[0]),conRowAttr.splice(0,1),conText.splice(0,1),conCellAttr.splice(0,
1),crsrRow--},insRow=function(a){var b=document.getElementsByClassName("vtx");b[a].parentNode.insertBefore(createNewRow(),b[a]);conRowAttr.splice(a,0,defRowAttr);conText.splice(a,0,"");conCellAttr.splice(a,0,[]);moveHotSpotsRows(a,conRowAttr.length,1);trimHistory()},delRow=function(a){expandToRow(a);var b=document.getElementsByClassName("vtx");b[a-1].parentNode.removeChild(b[a]);conRowAttr.splice(a,1);conText.splice(a,1);conCellAttr.splice(a,1);clearHotSpotsRow(a,0,999);moveHotSpotsRows(a+1,conRowAttr.length,
-1)},keyPress=function(a){a=a||window.event;var b=a.charCode;shiftState=a.shiftKey;ctrlState=a.ctrlKey;altState=a.altKey;capState=between(b,65,90)&&!shiftState||between(b,97,112)&&shiftState},keyDown=function(a){a=a||window.event;var b=a.keyCode||a.which;crsr.style.display="block";shiftState=a.shiftKey;ctrlState=a.ctrlKey;altState=a.altKey;if(!(termState>TS_NORMAL)){var d=(shiftState?1:0)+(ctrlState?2:0)+(altState?4:0);between(b,65,90)&&2>d&&capState&&(d^=1);cbm&&between(b,65,90)&&(d^=1);d=keyVals[d][b];
if(null==d||"function"==typeof d&&(d=d(),null==d))return a.returnValue=!0;if("string"==typeof d)return sendData(d),a.preventDefault(),a.returnValue=!1;if("number"==typeof d){if(0==d)return a.preventDefault(),a.returnValue=!0;if(0>d){switch(d){case DO_CAPLK:capState=!capState;setBulbs();break;case DO_NUMLK:numState=!numState;setBulbs();break;case DO_SCRLK:scrState=!scrState;setBulbs();break;default:return}a.preventDefault();return a.returnValue=!1}if(0<d)return sendData(d),a.preventDefault(),a.returnValue=
!1}}},keyUp=function(a){a=a||window.event;crsr.style.display="block";shiftState=a.shiftKey;ctrlState=a.ctrlKey;altState=a.altKey},click=function(a){var b,d;a=a||window.event;shiftState=a.shiftKey;ctrlState=a.ctrlKey;altState=a.altKey;if(!(termState>TS_NORMAL)&&(d=getHotSpot(a))){for(b=0;b<d.height;b++)for(a=0;a<d.width;a++)renderCell(d.row+b,d.col+a,d.hilite?2:0);switch(d.type){case 0:sendData(d.val);break;case 1:a=window.open(d.val,"_blank"),a.focus()}}},mouseMove=function(a){var b,d;a=a||window.event;
shiftState=a.shiftKey;ctrlState=a.ctrlKey;altState=a.altKey;if(!(termState>TS_NORMAL)){if(d=getHotSpot(a)){if(lastHotSpot!=d){if(lastHotSpot)for(b=0;b<lastHotSpot.height;b++)for(a=0;a<lastHotSpot.width;a++)renderCell(lastHotSpot.row+b,lastHotSpot.col+a);for(b=0;b<d.height;b++)for(a=0;a<d.width;a++)renderCell(d.row+b,d.col+a,d.hilite?1:0)}document.body.style.cursor="pointer"}else{if(lastHotSpot)for(b=0;b<lastHotSpot.height;b++)for(a=0;a<lastHotSpot.width;a++)renderCell(lastHotSpot.row+b,lastHotSpot.col+
a);document.body.style.cursor="default"}lastHotSpot=d}},mouseDown=function(a){a=a||window.event;shiftState=a.shiftKey;ctrlState=a.ctrlKey;altState=a.altKey},mouseUp=function(a){a=a||window.event;shiftState=a.shiftKey;ctrlState=a.ctrlKey;altState=a.altKey},getHotSpot=function(a){var b;if(b=getMouseCell(a))for(a=0;a<conHotSpots.length;a++){var d=conHotSpots[a];if(between(b.row,d.row,d.row+d.height-1)&&between(b.col,d.col,d.col+d.width-1))return conHotSpots[a]}return null},getMouseCell=function(a){var b=
a.clientX;var d=a.clientY+0;var c=textPos.top;if(d>=c&&between(b,textPos.left,textPos.left+crtWidth-1))for(a=0;a<conRowAttr.length;a++){var e=getRowAttrHeight(conRowAttr[a])/100;var f=getRowAttrWidth(conRowAttr[a])/100;e=Math.round(fontSize*e);if(between(d,c,c+e-1))return b=(b-textPos.left)/(xScale*colSize*f),{row:a,col:Math.floor(b)};c+=e}return null},redrawFont=function(a){var b,d;a=conFont.indexOf(a);if(0<=a)for(b=conRowAttr.length-1;0<=b;b--)for(d=conCellAttr[b].length-1;0<=d;d--){var c=(conCellAttr[b][d]&
A_CELL_FONT_MASK)>>>28;c==a&&renderCell(b,d,0,!1)}},loadSingleFont=function(a){var b,d=document.getElementsByTagName("head")[0];var c=vtxFonts.indexOf(a);if(0<=c&&!vtxFontsLoaded[c]){var e='@font-face {\r\n   font-family: "'+a+'";   src: url("'+a+'.woff") format("woff"); }\r\n';(b=document.getElementById("vtxfonts"))?b.innerHTML+=e:b=domElement("style",{type:"text/css"},{},e);d.appendChild(b);var f=domElement("div",{},{fontFamily:a+', "AdobeBlank"',fontSize:"24px",fontWeight:"normal",color:"transparent",
display:"inline-block",border:"0px",padding:"0px",margin:"0px"},"Test 1..2..3..");document.body.appendChild(f);var h=setInterval(function(){32<f.offsetWidth&&(vtxFontsLoaded[c]=!0,document.body.removeChild(f),clearInterval(h),setTimeout(function(){redrawFont(a)},250))},250)}},bootVTX2=function(){for(var a=document.getElementsByTagName("title")[0],b=document.getElementsByTagName("head")[0];!vtxdata;);a?a.innerText&&""!=a.innerText||(a.innerText=vtxdata.sysName):b.appendChild(domElement("title",{},
{},vtxdata.sysName));window.setTimeout(initDisplay,100)},bootVTX1=function(){var a,b;document.getElementsByTagName("title");document.getElementsByTagName("head");var d=[];vtxFontsLoaded=Array(vtxFonts.length);vtxFontsLoaded.fill(!1);var c=[];switch(vtxdata.term){case "PETSCII":switch(vtxdata.codePage){case "VIC20":c.push("VIC200");c.push("VIC201");break;case "C128":c.push("C1280");c.push("C1281");break;default:c.push("C640"),c.push("C641")}break;case "ATASCII":c.push("ATARI");break;default:c.push("UVGA16")}var e=
document.getElementById("vtxfonts");var f="";var h=0;for(b=c.length;h<b;h++)f+='@font-face {\r\n   font-family: "'+c[h]+'";   src: url("'+c[h]+'.woff") format("woff"); }\r\n';e.innerHTML+=f;h=0;for(b=c.length;h<b;h++)d[h]=domElement("div",{},{fontFamily:c[h]+', "AdobeBlank"',fontSize:"24px",fontWeight:"normal",color:"transparent",display:"inline-block",border:"0px",padding:"0px",margin:"0px"},"Test 1..2..3.."),document.body.appendChild(d[h]);var k=setInterval(function(){var b,e=c.length;for(b=c.length-
1;0<=b;b--)if(12<d[b].offsetWidth){for(a=0;a<vtxFonts.length;a++)if(vtxFonts[a]==c[b]){vtxFontsLoaded[a]=!0;break}e--}if(0==e){for(b=c.length-1;0<=b;b--)document.body.removeChild(d[b]);clearInterval(k);bootVTX2()}},50)},bootVTX=function(){var a=document.getElementsByTagName("head")[0];var b=domElement("style",{type:"text/css",id:"vtxfonts"},{},'@font-face { \n  font-family: "AdobeBlank";   src: url("AdobeBlank.woff") format("woff"); }\n');a.appendChild(b);var d=domElement("div",{},{fontFamily:'"AdobeBlank", sans-serif',
fontSize:"24px",fontWeight:"normal",color:"transparent",display:"inline-block",border:"0px",padding:"0px",margin:"0px"},"Test 1..2..3..");document.body.appendChild(d);var c=setInterval(function(){32>d.offsetWidth&&(document.body.removeChild(d),clearInterval(c),bootVTX1())},50)},between=function(a,b,d){return b<=a&&a<=d},minMax=function(a,b,d,c){c=void 0===c?null:c;null==c?(a<b&&(a=b),a>d&&(a=d)):(a<b&&(a=c),a>d&&(a=c));return a},int=function(a){return parseInt(a,10)},domElement=function(a,b,d,c){b=
void 0===b?null:b;d=void 0===d?null:d;c=void 0===c?null:c;a=document.createElement(a);var e;if(b)for(e in b)a[e]=b[e];if(d)for(e in d)a.style[e]=d[e];c&&a.appendChild(document.createTextNode(c));return a},addListener=function(a,b,d){a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent("on"+b,d)},ansiColors="transparent #AA0000 #00AA00 #AA5500 #0000AA #AA00AA #00AAAA #AAAAAA #555555 #FF5555 #55FF55 #FFFF55 #5555FF #FF55FF #55FFFF #FFFFFF #000000 #00005F #000087 #0000AF #0000D7 #0000FF #005F00 #005F5F #005F87 #005FAF #005FD7 #005FFF #008700 #00875F #008787 #0087AF #0087D7 #0087FF #00AF00 #00AF5F #00AF87 #00AFAF #00AFD7 #00AFFF #00D700 #00D75F #00D787 #00D7AF #00D7D7 #00D7FF #00FF00 #00FF5F #00FF87 #00FFAF #00FFD7 #00FFFF #5F0000 #5F005F #5F0087 #5F00AF #5F00D7 #5F00FF #5F5F00 #5F5F5F #5F5F87 #5F5FAF #5F5FD7 #5F5FFF #5F8700 #5F875F #5F8787 #5F87AF #5F87D7 #5F87FF #5FAF00 #5FAF5F #5FAF87 #5FAFAF #5FAFD7 #5FAFFF #5FD700 #5FD75F #5FD787 #5FD7AF #5FD7D7 #5FD7FF #5FFF00 #5FFF5F #5FFF87 #5FFFAF #5FFFD7 #5FFFFF #870000 #87005F #870087 #8700AF #8700D7 #8700FF #875F00 #875F5F #875F87 #875FAF #875FD7 #875FFF #878700 #87875F #878787 #8787AF #8787D7 #8787FF #87AF00 #87AF5F #87AF87 #87AFAF #87AFD7 #87AFFF #87D700 #87D75F #87D787 #87D7AF #87D7D7 #87D7FF #87FF00 #87FF5F #87FF87 #87FFAF #87FFD7 #87FFFF #AF0000 #AF005F #AF0087 #AF00AF #AF00D7 #AF00FF #AF5F00 #AF5F5F #AF5F87 #AF5FAF #AF5FD7 #AF5FFF #AF8700 #AF875F #AF8787 #AF87AF #AF87D7 #AF87FF #AFAF00 #AFAF5F #AFAF87 #AFAFAF #AFAFD7 #AFAFFF #AFD700 #AFD75F #AFD787 #AFD7AF #AFD7D7 #AFD7FF #AFFF00 #AFFF5F #AFFF87 #AFFFAF #AFFFD7 #AFFFFF #D70000 #D7005F #D70087 #D700AF #D700D7 #D700FF #D75F00 #D75F5F #D75F87 #D75FAF #D75FD7 #D75FFF #D78700 #D7875F #D78787 #D787AF #D787D7 #D787FF #D7AF00 #D7AF5F #D7AF87 #D7AFAF #D7AFD7 #D7AFFF #D7D700 #D7D75F #D7D787 #D7D7AF #D7D7D7 #D7D7FF #D7FF00 #D7FF5F #D7FF87 #D7FFAF #D7FFD7 #D7FFFF #FF0000 #FF005F #FF0087 #FF00AF #FF00D7 #FF00FF #FF5F00 #FF5F5F #FF5F87 #FF5FAF #FF5FD7 #FF5FFF #FF8700 #FF875F #FF8787 #FF87AF #FF87D7 #FF87FF #FFAF00 #FFAF5F #FFAF87 #FFAFAF #FFAFD7 #FFAFFF #FFD700 #FFD75F #FFD787 #FFD7AF #FFD7D7 #FFD7FF #FFFF00 #FFFF5F #FFFF87 #FFFFAF #FFFFD7 #FFFFFF #080808 #121212 #1C1C1C #262626 #303030 #3A3A3A #444444 #4E4E4E #585858 #626262 #6C6C6C #767676 #808080 #8A8A8A #949494 #9E9E9E #A8A8A8 #B2B2B2 #BCBCBC #C6C6C6 #D0D0D0 #DADADA #E4E4E4 #EEEEEE".split(" "),
vic20Colors="#000000 #FFFFFF #782922 #87D6DD #AA5FB6 #55A049 #40318D #BFCE72 #AA7449 #EAB489 #B86962 #C7FFFF #EA9FF6 #94E089 #8071CC #FFFFB2 #000000".split(" "),c64Colors="#000000 #FFFFFF #68372B #70A4B2 #6F3D86 #588D43 #352879 #B8C76F #6F4F25 #433900 #9A6759 #444444 #6C6C6C #9AD284 #6C5EB5 #959595 #000000".split(" "),c128Colors="#000000 #303030 #EA311B #FC601C #36C137 #77EC7C #1C49D9 #4487EF #BBC238 #E9F491 #D974DA #EECFED #68C8C2 #B2F0EC #BECEBC #FFFFFF #000000".split(" "),atariColors=["#0141A3",
"#64ACFF"],ttxToAnsiColor=[16,196,46,226,21,201,51,15],hex="0123456789ABCDEF",b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A_CELL_FGCOLOR_MASK=255,A_CELL_BGCOLOR_MASK=65280,A_CELL_REVERSE=65536,A_CELL_BOLD=131072,A_CELL_ITALICS=262144,A_CELL_UNDERLINE=524288,A_CELL_STRIKETHROUGH=1048576,A_CELL_BLINKSLOW=2097152,A_CELL_BLINKFAST=4194304,A_CELL_FAINT=8388608,A_CELL_DISPLAY_MASK=50331648,A_CELL_DISPLAY_NORMAL=0,A_CELL_DISPLAY_CONCEAL=16777216,A_CELL_DISPLAY_TOP=33554432,A_CELL_DISPLAY_BOTTOM=
50331648,A_CELL_SHADOW=67108864,A_CELL_OUTLINE=134217728,A_CELL_FONT_MASK=4026531840,A_ROW_COLOR1_MASK=255,A_ROW_COLOR2_MASK=65280,A_ROW_PATTERN_MASK=196608,A_ROW_PATTERN_NONE=0,A_ROW_PATTERN_SOLID=65536,A_ROW_PATTERN_HORZ=131072,A_ROW_PATTERN_VERT=196608,A_ROW_HEIGHT_MASK=1835008,A_ROW_HEIGHT_25=0,A_ROW_HEIGHT_50=262144,A_ROW_HEIGHT_75=524288,A_ROW_HEIGHT_100=786432,A_ROW_HEIGHT_125=1048576,A_ROW_HEIGHT_150=1310720,A_ROW_HEIGHT_175=1572864,A_ROW_HEIGHT_200=1835008,A_ROW_WIDTH_MASK=6291456,A_ROW_WIDTH_50=
0,A_ROW_WIDTH_100=2097152,A_ROW_WIDTH_150=4194304,A_ROW_WIDTH_200=6291456,A_ROW_MARQUEE=8388608,A_ROW_DISPLAY_MASK=50331648,A_ROW_DISPLAY_NORMAL=0,A_ROW_DISPLAY_CONCEAL=16777216,A_ROW_DISPLAY_TOP=33554432,A_ROW_DISPLAY_BOTTOM=50331648,A_CRSR_COLOR_MASK=255,A_CRSR_STYLE_MASK=768,A_CRSR_STYLE_NONE=0,A_CRSR_STYLE_THIN=256,A_CRSR_STYLE_THICK=512,A_CRSR_STYLE_FULL=768,A_CRSR_ORIENTATION=1024,DO_CAPLK=-2,DO_NUMLK=-3,DO_SCRLK=-4,TS_OFFLINE=-1,TS_NORMAL=0,TS_YMR_START=1,TS_YMR_GETPACKET=2,TS_YMS_START=3,
TS_YMS_PUTPACKET=4,TS_YMS_PUTWAIT=5,bauds=[0,3,6,12,24,48,96,192,384,576,768,1152],_NUL=0,_SOH=1,_STX=2,_ETX=3,_EOT=4,_ENQ=5,_ACK=6,_BEL=7,_BS=8,_HT=9,_LF=10,_VT=11,_FF=12,_CR=13,_SO=14,_SI=15,_DLE=16,_DC1=17,_XON=17,_DC2=18,_DC3=19,_XOFF=19,_DC4=20,_NAK=21,_SYN=22,_ETB=23,_CAN=24,_EM=25,_SUB=26,_CPMEOF=26,_ESC=27,_FS=28,_GS=29,_RS=30,_US=31,_SPACE=32,_C=67,_G=71,_DEL=127,_BLANK=32,_SHY=8208,NUL="\x00",ESC="\u001b",CSI="\u001b[",CR="\r",LF="\n",CRLF="\r\n",codePageAKAs={CP790:"CP667",CP991:"CP667",
CP1119:"CP772",CP1118:"CP774",CP900:"CP866",CP895:"CP866",CP65001:"UTF8",CP819:"ISO8859_1",CP28593:"ISO8859_3",VIC20:"RAW",C64:"RAW",C128:"RAW",ATASCII:"RAW"},codePageData={ASCII:new Uint16Array([_BLANK,9786,9787,9829,9830,9827,9824,8226,9688,9675,9689,9794,9792,9834,9835,9788,9658,9668,8597,8252,182,167,9644,8616,8593,8595,8594,8592,8735,8596,9650,9660,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,
81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,8962]),CP437:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,225,237,243,250,241,209,170,186,191,8976,172,189,188,161,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,
9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,_BLANK]),CP667:new Uint16Array([199,252,233,226,228,224,261,231,234,235,232,239,238,263,196,260,280,281,322,244,246,262,251,249,346,214,220,162,321,165,347,402,377,379,243,211,324,323,378,380,191,8976,172,189,188,161,171,187,9617,9618,9619,
9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP668:new Uint16Array([199,252,233,226,228,224,263,231,322,235,232,239,238,377,196,262,201,230,198,244,246,242,251,346,347,214,220,162,
163,321,211,402,225,237,243,250,260,261,379,380,280,281,172,378,323,324,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP737:new Uint16Array([913,914,915,916,
917,918,919,920,921,922,923,924,925,926,927,928,929,931,932,933,934,935,936,937,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,963,962,964,965,966,967,968,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,969,940,941,942,970,943,972,973,971,974,902,904,905,906,908,910,911,177,8805,8804,938,
939,247,8776,176,8729,183,8730,8319,178,9632,160]),CP770:new Uint16Array([268,252,279,257,228,261,316,269,275,274,281,280,299,303,196,260,278,382,381,245,246,213,363,371,291,214,220,162,315,8222,353,352,256,298,311,310,326,325,362,370,290,8976,172,189,188,302,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,
9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP771:new Uint16Array([1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,
9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,260,261,268,269,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,280,281,278,279,302,303,352,353,370,371,362,363,381,382,9632,160]),CP772:new Uint16Array([1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,
1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,9617,9618,9619,9474,9508,260,268,280,278,9571,9553,9559,9565,302,352,9488,9492,9524,9516,9500,9472,9532,370,362,9562,9556,9577,9574,9568,9552,9580,381,261,269,281,279,303,353,371,363,382,9496,9484,9608,9604,9612,9616,9600,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1025,1105,8222,8220,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP773:new Uint16Array([262,252,233,257,228,291,229,263,322,275,342,343,299,
377,196,197,201,230,198,333,246,290,162,346,347,214,220,248,163,216,215,164,256,298,243,379,380,378,8221,166,169,174,172,189,188,321,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,260,261,268,269,211,223,332,323,245,213,181,324,310,311,315,316,326,274,325,8217,280,281,278,279,302,303,352,353,370,371,362,363,381,382,9632,
160]),CP774:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,225,237,243,250,241,209,170,186,191,8976,172,189,188,161,171,187,9617,9618,9619,9474,9508,260,268,280,278,9571,9553,9559,9565,302,352,9488,9492,9524,9516,9500,9472,9532,370,362,9562,9556,9577,9574,9568,9552,9580,381,261,269,281,279,303,353,371,363,382,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,
949,8745,8801,177,8805,8804,8222,8220,247,8776,176,8729,183,8730,8319,178,9632,160]),CP775:new Uint16Array([262,252,233,257,228,291,229,263,322,275,342,343,299,377,196,197,201,230,198,333,246,290,162,346,347,214,220,248,163,216,215,164,256,298,243,379,380,378,8221,166,169,174,172,189,188,321,171,187,9617,9618,9619,9474,9508,260,268,280,278,9571,9553,9559,9565,302,352,9488,9492,9524,9516,9500,9472,9532,370,362,9562,9556,9577,9574,9568,9552,9580,381,261,269,281,279,303,353,371,363,382,9496,9484,9608,
9604,9612,9616,9600,211,223,332,323,245,213,181,324,310,311,315,316,326,274,325,8217,_SHY,177,8220,190,182,167,247,8222,176,8729,183,185,179,178,9632,160]),CP808:new Uint16Array([1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,
9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1025,1105,1028,1108,1031,1111,1038,1118,176,8729,183,8730,8470,8364,9632,160]),CP813:new Uint16Array([160,8216,8217,163,8364,_BLANK,166,167,168,169,_BLANK,171,172,_SHY,_BLANK,8213,176,177,178,179,180,901,902,903,904,905,906,187,908,189,910,911,912,913,914,915,916,917,
918,919,920,921,922,923,924,925,926,927,928,929,_BLANK,931,932,933,934,935,936,937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,962,963,964,965,966,967,968,969,970,971,972,973,974,_BLANK]),CP850:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,248,163,216,215,402,225,237,243,250,241,209,170,186,191,174,172,189,188,161,171,187,9617,9618,9619,9474,9508,193,194,192,169,9571,
9553,9559,9565,162,165,9488,9492,9524,9516,9500,9472,9532,227,195,9562,9556,9577,9574,9568,9552,9580,164,240,208,202,203,200,305,205,206,207,9496,9484,9608,9604,166,204,9600,211,223,212,210,245,213,181,254,222,218,219,217,253,221,175,180,_SHY,177,8215,190,182,167,247,184,176,168,183,185,179,178,9632,160]),CP851:new Uint16Array([199,252,233,226,228,224,902,231,234,235,232,239,238,904,196,905,906,_BLANK,908,244,246,910,251,249,911,214,220,940,163,941,942,943,970,912,972,973,913,914,915,916,917,918,
919,189,920,921,171,187,9617,9618,9619,9474,9508,922,923,924,925,9571,9553,9559,9565,926,927,9488,9492,9524,9516,9500,9472,9532,928,929,9562,9556,9577,9574,9568,9552,9580,931,932,933,934,935,936,937,945,946,947,9496,9484,9608,9604,948,949,9600,950,951,952,953,954,955,956,957,958,959,960,961,963,962,964,900,_SHY,177,965,966,967,167,968,901,176,168,969,971,944,974,9632,160]),CP852:new Uint16Array([199,252,233,226,228,367,263,231,322,235,336,337,238,377,196,262,201,313,314,244,246,317,318,346,347,214,
220,356,357,321,215,269,225,237,243,250,260,261,381,382,280,281,172,378,268,351,171,187,9617,9618,9619,9474,9508,193,194,282,350,9571,9553,9559,9565,379,380,9488,9492,9524,9516,9500,9472,9532,258,259,9562,9556,9577,9574,9568,9552,9580,164,273,272,270,203,271,327,205,206,283,9496,9484,9608,9604,354,366,9600,211,223,212,323,324,328,352,353,340,218,341,368,253,221,355,180,_SHY,733,731,711,728,167,247,184,176,168,729,369,344,345,9632,160]),CP853:new Uint16Array([199,252,233,226,228,224,265,231,234,235,
232,239,238,236,196,264,201,267,266,244,246,242,251,249,304,214,220,285,163,284,215,309,225,237,243,250,241,209,286,287,292,293,_BLANK,189,308,351,171,187,9617,9618,9619,9474,9508,193,194,192,350,9571,9553,9559,9565,379,380,9488,9492,9524,9516,9500,9472,9532,348,349,9562,9556,9577,9574,9568,9552,9580,164,_BLANK,_BLANK,202,203,200,305,205,206,207,9496,9484,9608,9604,_BLANK,204,9600,211,223,212,210,288,289,181,294,295,218,219,217,364,365,183,180,_SHY,_BLANK,8467,329,728,167,247,184,176,168,729,_BLANK,
179,178,9632,160]),CP855:new Uint16Array([1106,1026,1107,1027,1105,1025,1108,1028,1109,1029,1110,1030,1111,1031,1112,1032,1113,1033,1114,1034,1115,1035,1116,1036,1118,1038,1119,1039,1102,1070,1098,1066,1072,1040,1073,1041,1094,1062,1076,1044,1077,1045,1092,1060,1075,1043,171,187,9617,9618,9619,9474,9508,1093,1061,1080,1048,9571,9553,9559,9565,1081,1049,9488,9492,9524,9516,9500,9472,9532,1082,1050,9562,9556,9577,9574,9568,9552,9580,164,1083,1051,1084,1052,1085,1053,1086,1054,1087,9496,9484,9608,9604,
1055,1103,9600,1071,1088,1056,1089,1057,1090,1058,1091,1059,1078,1046,1074,1042,1100,1068,8470,_SHY,1099,1067,1079,1047,1096,1064,1101,1069,1097,1065,1095,1063,167,9632,160]),CP857:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,305,196,197,201,230,198,244,246,242,251,249,304,214,220,248,163,216,350,351,225,237,243,250,241,209,286,287,191,174,172,189,188,161,171,187,9617,9618,9619,9474,9508,193,194,192,169,9571,9553,9559,9565,162,165,9488,9492,9524,9516,9500,9472,9532,227,195,
9562,9556,9577,9574,9568,9552,9580,164,186,170,202,203,200,8364,205,206,207,9496,9484,9608,9604,166,204,9600,211,223,212,210,245,213,181,_BLANK,215,218,219,217,236,255,175,180,_SHY,177,_BLANK,190,182,167,247,184,176,168,183,185,179,178,9632,160]),CP858:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,248,163,216,215,402,225,237,243,250,241,209,170,186,191,174,172,189,188,161,171,187,9617,9618,9619,9474,9508,193,194,192,169,
9571,9553,9559,9565,162,165,9488,9492,9524,9516,9500,9472,9532,227,195,9562,9556,9577,9574,9568,9552,9580,164,240,208,202,203,200,8364,205,206,207,9496,9484,9608,9604,166,204,9600,211,223,212,210,245,213,181,254,222,218,219,217,253,221,175,180,_SHY,177,8215,190,182,167,247,184,176,168,183,185,179,178,9632,160]),CP859:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,248,163,216,215,402,225,237,243,250,241,209,170,186,191,174,
172,339,338,161,171,187,9617,9618,9619,9474,9508,193,194,192,169,9571,9553,9559,9565,162,165,9488,9492,9524,9516,9500,9472,9532,227,195,9562,9556,9577,9574,9568,9552,9580,164,240,208,202,203,200,8364,205,206,207,9496,9484,9608,9604,352,204,9600,211,223,212,210,245,213,181,254,222,218,219,217,253,221,175,381,_SHY,177,_BLANK,376,182,167,247,382,176,353,183,185,179,178,9632,160]),CP860:new Uint16Array([199,252,233,226,227,224,193,231,234,202,232,205,212,236,195,194,201,192,200,244,245,242,218,249,204,
213,220,162,163,217,8359,211,225,237,243,250,241,209,170,186,191,210,172,189,188,161,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP861:new Uint16Array([199,
252,233,226,228,224,229,231,234,235,232,208,240,222,196,197,201,230,198,244,246,254,251,221,253,214,220,248,163,216,8359,402,225,237,243,250,193,205,211,218,191,8976,172,189,188,161,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,
177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP863:new Uint16Array([199,252,233,226,194,224,182,231,234,235,232,239,238,8215,192,167,201,200,202,244,203,207,251,249,164,212,220,162,163,217,219,402,166,180,243,250,168,184,179,175,206,8976,172,189,188,190,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,
9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP865:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,248,163,216,8359,402,225,237,243,250,241,209,170,186,191,8976,172,189,188,161,171,164,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,
9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),CP866:new Uint16Array([1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,
1084,1085,1086,1087,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,1025,1105,1028,1108,1031,1111,1038,1118,176,8729,183,8730,8470,164,9632,160]),CP867:new Uint16Array([268,252,233,271,228,270,356,269,283,282,313,205,318,314,196,
193,201,382,381,244,246,211,367,218,253,214,220,352,317,221,344,357,225,237,243,250,328,327,366,212,353,345,341,340,188,167,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,
9632,160]),CP869:new Uint16Array([_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,902,_BLANK,183,172,166,8216,8217,904,8213,905,906,938,908,_BLANK,_BLANK,910,939,169,911,178,179,940,163,941,942,943,970,912,972,973,913,914,915,916,917,918,919,189,920,921,171,187,9617,9618,9619,9474,9508,922,923,924,925,9571,9553,9559,9565,926,927,9488,9492,9524,9516,9500,9472,9532,928,929,9562,9556,9577,9574,9568,9552,9580,931,932,933,934,935,936,937,945,946,947,9496,9484,9608,9604,948,949,9600,950,951,952,953,954,955,956,
957,958,959,960,961,963,962,964,900,_SHY,177,965,966,967,167,968,901,176,168,969,971,944,974,9632,160]),CP872:new Uint16Array([1106,1026,1107,1027,1105,1025,1108,1028,1109,1029,1110,1030,1111,1031,1112,1032,1113,1033,1114,1034,1115,1035,1116,1036,1118,1038,1119,1039,1102,1070,1098,1066,1072,1040,1073,1041,1094,1062,1076,1044,1077,1045,1092,1060,1075,1043,171,187,9617,9618,9619,9474,9508,1093,1061,1080,1048,9571,9553,9559,9565,1081,1049,9488,9492,9524,9516,9500,9472,9532,1082,1050,9562,9556,9577,9574,
9568,9552,9580,8364,1083,1051,1084,1052,1085,1053,1086,1054,1087,9496,9484,9608,9604,1055,1103,9600,1071,1088,1056,1089,1057,1090,1058,1091,1059,1078,1046,1074,1042,1100,1068,8470,_SHY,1099,1067,1079,1047,1096,1064,1101,1069,1097,1065,1095,1063,167,9632,160]),CP878:new Uint16Array([9472,9474,9484,9488,9492,9496,9500,9508,9516,9524,9532,9600,9604,9608,9612,9616,9617,9618,9619,8992,9632,8729,8730,8776,8804,8805,160,8993,176,178,183,247,9552,9553,9554,1105,9555,9556,9557,9558,9559,9560,9561,9562,9563,
9564,9565,9566,9567,9568,9569,1025,9570,9571,9572,9573,9574,9575,9576,9577,9578,9579,9580,169,1102,1072,1073,1094,1076,1077,1092,1075,1093,1080,1081,1082,1083,1084,1085,1086,1087,1103,1088,1089,1090,1091,1078,1074,1100,1099,1079,1096,1101,1097,1095,1098,1070,1040,1041,1062,1044,1045,1060,1043,1061,1048,1049,1050,1051,1052,1053,1054,1055,1071,1056,1057,1058,1059,1046,1042,1068,1067,1047,1064,1069,1065,1063,1066]),CP912:new Uint16Array([9617,9618,9619,9474,9508,9496,9484,9608,169,9571,9553,9559,9565,
162,165,9488,9492,9524,9516,9500,9472,9532,9604,9600,9562,9556,9577,9574,9568,9552,9580,174,160,260,728,321,164,317,346,167,168,352,350,356,377,_SHY,381,379,176,261,731,322,180,318,347,711,184,353,351,357,378,733,382,380,340,193,194,258,196,313,262,199,268,201,280,203,282,205,206,270,272,323,327,211,212,336,214,215,344,366,218,368,220,221,354,223,341,225,226,259,228,314,263,231,269,233,281,235,283,237,238,271,273,324,328,243,244,337,246,247,345,367,250,369,252,253,355,729]),CP915:new Uint16Array([9617,
9618,9619,9474,9508,9496,9484,9608,169,9571,9553,9559,9565,162,165,9488,9492,9524,9516,9500,9472,9532,9604,9600,9562,9556,9577,9574,9568,9552,9580,164,160,1025,1026,1027,1028,1029,1030,1031,1032,1033,1034,1035,1036,_SHY,1038,1039,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,
1095,1096,1097,1098,1099,1100,1101,1102,1103,8470,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,167,1118,1119]),CP920:new Uint16Array([160,161,162,163,164,165,166,167,168,169,170,171,172,_SHY,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,286,209,210,211,212,213,214,215,216,217,218,219,220,304,350,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,287,241,242,243,244,245,246,247,
248,249,250,251,252,305,351,255]),CP1117:new Uint16Array([262,252,233,257,228,291,229,263,322,275,279,303,299,377,196,197,201,379,380,333,246,290,363,346,347,214,220,324,315,321,215,269,256,298,243,371,260,261,381,382,280,281,278,378,268,302,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,211,223,332,
323,245,213,352,353,310,311,362,370,316,274,325,326,_SHY,177,230,198,182,164,247,248,176,216,183,343,342,8222,8220,160]),CPMIK:new Uint16Array([1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,9492,9524,9516,9500,9472,9532,9571,9553,
9562,9556,9577,9574,9568,9552,9580,9488,9617,9618,9619,9474,9508,8470,167,9559,9565,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]),WIN1250:new Uint16Array([8364,_BLANK,8218,_BLANK,8222,8230,8224,8225,_BLANK,8240,352,8249,346,356,381,377,_BLANK,8216,8217,8220,8221,8226,8211,8212,_BLANK,8482,353,8250,347,357,382,378,160,711,728,321,164,260,166,167,168,169,350,171,172,_SHY,
174,379,176,177,731,322,180,181,182,183,184,261,351,187,317,733,318,380,340,193,194,258,196,313,262,199,268,201,280,203,282,205,206,270,272,323,327,211,212,336,214,215,344,366,218,368,220,221,354,223,341,225,226,259,228,314,263,231,269,233,281,235,283,237,238,271,273,324,328,243,244,337,246,247,345,367,250,369,252,253,355,729]),WIN1251:new Uint16Array([1026,1027,8218,1107,8222,8230,8224,8225,8364,8240,1033,8249,1034,1036,1035,1039,1106,8216,8217,8220,8221,8226,8211,8212,_BLANK,8482,1113,8250,1114,
1116,1115,1119,160,1038,1118,1032,164,1168,166,167,1025,169,1028,171,172,_SHY,174,1031,176,177,1030,1110,1169,181,182,183,1105,8470,1108,187,1112,1029,1109,1111,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103]),WIN1253:new Uint16Array([8364,
_BLANK,8218,402,8222,8230,8224,8225,_BLANK,8240,_BLANK,8249,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,8216,8217,8220,8221,8226,8211,8212,_BLANK,8482,_BLANK,8250,_BLANK,_BLANK,_BLANK,_BLANK,160,901,902,163,164,165,166,167,168,169,_BLANK,171,172,_SHY,174,8213,176,177,178,179,900,181,182,183,904,905,906,187,908,189,910,911,912,913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,_BLANK,931,932,933,934,935,936,937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,
958,959,960,961,962,963,964,965,966,967,968,969,970,971,972,973,974,_BLANK]),WIN1254:new Uint16Array([8364,_BLANK,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,_BLANK,_BLANK,_BLANK,_BLANK,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,_BLANK,_BLANK,376,160,161,162,163,164,165,166,167,168,169,170,171,172,_SHY,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,286,209,210,211,212,213,214,215,216,217,
218,219,220,304,350,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,287,241,242,243,244,245,246,247,248,249,250,251,252,305,351,255]),WIN1257:new Uint16Array([8364,_BLANK,8218,_BLANK,8222,8230,8224,8225,_BLANK,8240,_BLANK,8249,_BLANK,168,711,184,_BLANK,8216,8217,8220,8221,8226,8211,8212,_BLANK,8482,_BLANK,8250,_BLANK,175,731,_BLANK,160,_BLANK,162,163,164,_BLANK,166,167,216,169,342,171,172,_SHY,174,198,176,177,178,179,180,181,182,183,248,185,343,187,188,189,190,230,260,302,256,
262,196,197,280,274,268,201,377,278,290,310,298,315,352,323,325,211,332,213,214,215,370,321,346,362,220,379,381,223,261,303,257,263,228,229,281,275,269,233,378,279,291,311,299,316,353,324,326,243,333,245,246,247,371,322,347,363,252,380,382,729]),KOI8_R:new Uint16Array([9472,9474,9484,9488,9492,9496,9500,9508,9516,9524,9532,9600,9604,9608,9612,9616,9617,9618,9619,8992,9632,8729,8730,8776,8804,8805,160,8993,176,178,183,247,9552,9553,9554,1105,9555,9556,9557,9558,9559,9560,9561,9562,9563,9564,9565,9566,
9567,9568,9569,1025,9570,9571,9572,9573,9574,9575,9576,9577,9578,9579,9580,169,1102,1072,1073,1094,1076,1077,1092,1075,1093,1080,1081,1082,1083,1084,1085,1086,1087,1103,1088,1089,1090,1091,1078,1074,1100,1099,1079,1096,1101,1097,1095,1098,1070,1040,1041,1062,1044,1045,1060,1043,1061,1048,1049,1050,1051,1052,1053,1054,1055,1071,1056,1057,1058,1059,1046,1042,1068,1067,1047,1064,1069,1065,1063,1066]),KOI8_U:new Uint16Array([9472,9474,9484,9488,9492,9496,9500,9508,9516,9524,9532,9600,9604,9608,9612,9616,
9617,9618,9619,8992,9632,8729,8730,8776,8804,8805,160,8993,176,178,183,247,9552,9553,9554,1105,1108,9556,1110,1111,9559,9560,9561,9562,9563,1169,9565,9566,9567,9568,9569,1025,1028,9571,1030,1031,9574,9575,9576,9577,9578,1168,9580,169,1102,1072,1073,1094,1076,1077,1092,1075,1093,1080,1081,1082,1083,1084,1085,1086,1087,1103,1088,1089,1090,1091,1078,1074,1100,1099,1079,1096,1101,1097,1095,1098,1070,1040,1041,1062,1044,1045,1060,1043,1061,1048,1049,1050,1051,1052,1053,1054,1055,1071,1056,1057,1058,1059,
1046,1042,1068,1067,1047,1064,1069,1065,1063,1066]),ISO8859_1:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,161,162,163,164,165,166,167,168,169,170,171,172,8208,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,
233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]),ISO8859_2:new Uint16Array([9472,9474,9484,9488,9492,9496,9500,9508,9516,9524,9532,9600,9604,9608,9612,9616,9617,9618,9619,8992,9632,8729,8730,8776,8804,8805,160,8993,176,178,183,247,160,260,728,321,164,317,346,167,168,352,350,356,377,8208,381,379,176,261,731,322,180,318,347,711,184,353,351,357,378,733,382,380,340,193,194,258,196,313,262,199,268,201,280,203,282,205,206,270,272,323,327,211,212,336,214,215,
344,366,218,368,220,221,354,223,341,225,226,259,228,314,263,231,269,233,281,235,283,237,238,271,273,324,328,243,244,337,246,247,345,367,250,369,252,253,355,729]),ISO8859_3:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,294,728,163,164,_BLANK,292,167,168,304,350,286,308,8208,_BLANK,379,176,295,178,179,180,181,293,183,184,305,351,287,309,189,_BLANK,380,192,193,194,_BLANK,196,266,264,199,200,201,202,
203,204,205,206,207,_BLANK,209,210,211,212,288,214,215,284,217,218,219,220,364,348,223,224,225,226,_BLANK,228,267,265,231,232,233,234,235,236,237,238,239,_BLANK,241,242,243,244,289,246,247,285,249,250,251,252,365,349,729]),ISO8859_4:new Uint16Array([9472,9474,9484,9488,9492,9496,9500,9508,9516,9524,9532,9600,9604,9608,9612,9616,9617,9618,9619,8992,9632,8729,8730,8776,8804,8805,160,8993,176,178,183,247,160,260,312,342,164,296,315,167,168,352,274,290,358,8208,381,175,176,261,731,343,180,297,316,711,
184,353,275,291,359,330,382,331,256,193,194,195,196,197,198,302,268,201,280,203,278,205,206,298,272,325,332,310,212,213,214,215,216,370,218,219,220,360,362,223,257,225,226,227,228,229,230,303,269,233,281,235,279,237,238,299,273,326,333,311,244,245,246,247,248,371,250,251,252,361,363,729]),ISO8859_5:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,1025,1026,1027,1028,1029,1030,1031,1032,1033,1034,1035,
1036,8208,1038,1039,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,8470,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,167,1118,1119]),ISO8859_7:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,
196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,8216,8217,163,8364,8367,166,167,168,169,890,171,172,8208,_BLANK,8213,176,177,178,179,900,901,902,183,904,905,906,187,908,189,910,911,912,913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,_BLANK,931,932,933,934,935,936,937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,962,963,964,965,966,967,968,969,970,971,972,973,974,_BLANK]),ISO8859_9:new Uint16Array([199,
252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,161,162,163,164,165,166,167,168,169,170,171,172,_SHY,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,286,209,210,211,212,213,214,215,216,217,218,219,220,304,350,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,287,241,242,243,244,245,246,247,248,249,250,251,252,305,
351,255]),ISO8859_10:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,260,274,290,298,296,310,167,315,272,352,358,381,_SHY,362,330,176,261,275,291,299,297,311,183,316,273,353,359,382,8213,363,331,256,193,194,195,196,197,198,302,268,201,280,203,278,205,206,207,208,325,332,211,212,213,214,360,216,370,218,219,220,221,222,223,257,225,226,227,228,229,230,303,269,233,281,235,279,237,238,239,240,326,333,
243,244,245,246,361,248,371,250,251,252,253,254,312]),ISO8859_13:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,8221,162,163,164,8222,166,167,216,169,342,171,172,_SHY,174,198,176,177,178,179,8220,181,182,183,248,185,343,187,188,189,190,230,260,302,256,262,196,197,280,274,268,201,377,278,290,310,298,315,352,323,325,211,332,213,214,215,370,321,346,362,220,379,381,223,261,303,257,263,228,229,281,275,
269,233,378,279,291,311,299,316,353,324,326,243,333,245,246,247,371,322,347,363,252,380,382,8217]),ISO8859_14:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,7682,7683,163,266,267,7690,167,7808,169,7810,7691,7922,_SHY,174,376,7710,7711,288,289,7744,7745,182,7766,7809,7767,7811,7776,7923,7812,7813,7777,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,372,209,210,211,212,213,214,7786,
216,217,218,219,220,221,374,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,373,241,242,243,244,245,246,7787,248,249,250,251,252,253,375,255]),ISO8859_15:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,161,162,163,8364,165,352,167,353,169,170,171,172,_SHY,174,175,176,177,178,179,381,181,182,183,382,185,186,187,338,339,376,191,192,193,194,195,196,197,198,199,200,201,202,203,204,
205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]),ISO8859_16:new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,160,260,261,321,8364,8222,352,167,353,169,536,171,377,_SHY,378,379,176,177,268,322,381,8221,182,183,382,269,537,187,338,339,376,380,192,193,
194,258,196,262,198,199,200,201,202,203,204,205,206,207,272,323,210,211,212,336,214,346,368,217,218,219,220,280,538,223,224,225,226,259,228,263,230,231,232,233,234,235,236,237,238,239,273,324,242,243,244,337,246,347,369,249,250,251,252,281,539,255]),ARMSCII_8:new Uint16Array([160,1422,1415,1417,41,40,187,168,8212,183,1369,1373,45,1375,8230,1372,1371,1374,1329,1377,1330,1378,1331,1379,1332,1380,1333,1381,1334,1382,1335,1383,1336,1384,1337,1385,1338,1386,1339,1387,1340,1388,1341,1389,1342,1390,1343,
1391,1344,1392,1345,1393,1346,1394,1347,1395,1348,1396,1349,1397,1350,1398,1351,1399,1352,1400,1353,1401,1354,1402,1355,1403,1356,1404,1357,1405,1358,1406,1359,1407,1360,1408,1361,1409,1362,1410,1363,1411,1364,1412,1365,1413,1366,1414,1370,_BLANK]),HAIK8:new Uint16Array([160,1422,1415,1417,41,40,187,168,8212,183,1369,1373,45,1375,8230,1372,1371,1374,1329,1377,1330,1378,1331,1379,1332,1380,1333,1381,1334,1382,1335,1383,1336,1384,1337,1385,1338,1386,1339,1387,1340,1388,1341,1389,1342,1390,1343,1391,
1344,1392,1345,1393,1346,1394,1347,1395,1348,1396,1349,1397,1350,1398,1351,1399,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,1352,1400,1353,1401,1354,1402,1355,1403,1356,1404,1357,1405,1358,1406,1359,1407,1360,1408,1361,1409,1362,1410,1363,1411,1364,1412,1365,1413,1366,1414,1370,_BLANK]),CP1131:new Uint16Array([1040,1041,
1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,1088,1089,1090,1091,1092,1093,1094,
1095,1096,1097,1098,1099,1100,1101,1102,1103,1025,1105,1028,1108,1031,1111,1038,1118,1030,1110,183,164,1168,1169,8729,160]),TELETEXT:new Uint16Array([_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,
75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,8592,189,8594,8593,8212,163,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,188,8214,190,247,9632,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,
_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,
_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK,_BLANK]),RAW:new Uint16Array([57344,57345,57346,57347,57348,57349,57350,57351,57352,57353,57354,57355,57356,57357,57358,57359,57360,57361,57362,57363,57364,57365,57366,57367,57368,57369,57370,57371,57372,57373,57374,57375,57376,57377,57378,57379,57380,57381,57382,57383,57384,57385,57386,57387,57388,57389,57390,57391,57392,57393,57394,57395,57396,57397,57398,57399,57400,57401,57402,57403,57404,57405,57406,57407,57408,57409,
57410,57411,57412,57413,57414,57415,57416,57417,57418,57419,57420,57421,57422,57423,57424,57425,57426,57427,57428,57429,57430,57431,57432,57433,57434,57435,57436,57437,57438,57439,57440,57441,57442,57443,57444,57445,57446,57447,57448,57449,57450,57451,57452,57453,57454,57455,57456,57457,57458,57459,57460,57461,57462,57463,57464,57465,57466,57467,57468,57469,57470,57471,57472,57473,57474,57475,57476,57477,57478,57479,57480,57481,57482,57483,57484,57485,57486,57487,57488,57489,57490,57491,57492,57493,
57494,57495,57496,57497,57498,57499,57500,57501,57502,57503,57504,57505,57506,57507,57508,57509,57510,57511,57512,57513,57514,57515,57516,57517,57518,57519,57520,57521,57522,57523,57524,57525,57526,57527,57528,57529,57530,57531,57532,57533,57534,57535,57536,57537,57538,57539,57540,57541,57542,57543,57544,57545,57546,57547,57548,57549,57550,57551,57552,57553,57554,57555,57556,57557,57558,57559,57560,57561,57562,57563,57564,57565,57566,57567,57568,57569,57570,57571,57572,57573,57574,57575,57576,57577,
57578,57579,57580,57581,57582,57583,57584,57585,57586,57587,57588,57589,57590,57591,57592,57593,57594,57595,57596,57597,57598,57599]),RAWHI:new Uint16Array([128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,
214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255])},keysS0C0A0={0:0,8:function(){return cbm?20:atari?126:_BS},9:function(){return cbm?(conFontNum^=1,renderAll(),0):atari?127:9},12:0,13:function(){return atari?155:_CR},16:0,17:0,18:0,19:0,20:DO_CAPLK,27:function(){return cbm?3:_ESC},32:" ",33:function(){return modeDOORWAY?"\x00I":CSI+"V"},34:function(){return modeDOORWAY?"\x00Q":CSI+
"U"},35:function(){return cbm?14:modeDOORWAY?"\x00O":CSI+"K"},36:function(){return cbm?19:modeDOORWAY?"\x00G":CSI+"H"},37:function(){return cbm?157:atari?30:modeDOORWAY?"\x00K":CSI+"D"},38:function(){return cbm?145:atari?28:modeDOORWAY?"\x00H":CSI+"A"},39:function(){return cbm?29:atari?31:modeDOORWAY?"\x00M":CSI+"C"},40:function(){return cbm?17:atari?29:modeDOORWAY?"\x00P":CSI+"B"},45:function(){return cbm?148:atari?255:modeDOORWAY?"\x00R":CSI+"@"},46:function(){return cbm?20:atari?254:127},48:"0",
49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:0,92:0,93:0,96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:function(){return cbm?133:modeDOORWAY?"\x00;":ESC+"OP"},113:function(){return cbm?137:modeDOORWAY?"\x00<":ESC+
"OQ"},114:function(){return cbm?134:modeDOORWAY?"\x00=":ESC+"OR"},115:function(){return cbm?138:modeDOORWAY?"\x00>":ESC+"OS"},116:function(){return cbm?135:modeDOORWAY?"\x00?":ESC+"Ot"},117:function(){return cbm?139:modeDOORWAY?"\x00@":CSI+"17~"},118:function(){return cbm?136:modeDOORWAY?"\x00A":CSI+"18~"},119:function(){return cbm?140:modeDOORWAY?"\x00B":CSI+"19~"},120:function(){return modeDOORWAY?"\x00C":CSI+"20~"},121:function(){return modeDOORWAY?"\x00D":CSI+"21~"},122:CSI+"23~",123:CSI+"24~",
124:0,125:0,126:0,127:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:0,144:DO_NUMLK,145:DO_SCRLK,173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",255:0},keysS1C0A0={9:function(){return atari?159:modeDOORWAY?"\x00\u000f":0},13:function(){return cbm?141:0},32:"\u00a0",35:function(){return cbm?142:0},36:function(){return cbm?147:atari?125:0},45:function(){return atari?157:0},46:function(){return atari?156:0},48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",
55:"&",56:"*",57:"(",59:":",61:"+",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",112:function(){return modeDOORWAY?"\x00T":0},113:function(){return modeDOORWAY?"\x00U":0},114:function(){return modeDOORWAY?"\x00V":0},115:function(){return modeDOORWAY?"\x00W":0},116:null,117:function(){return modeDOORWAY?"\x00Y":0},118:function(){return modeDOORWAY?"\x00Z":0},119:function(){return modeDOORWAY?
"\x00[":0},120:function(){return modeDOORWAY?"\x00\\":0},121:function(){return modeDOORWAY?"\x00]":0},173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},keysS0C1A0={9:function(){return atari?158:0},33:function(){return modeDOORWAY?"\x00\u0084":0},34:function(){return modeDOORWAY?"\x00v":0},35:function(){return modeDOORWAY?"\x00u":0},36:function(){return modeDOORWAY?"/x00/x77":0},37:function(){return modeDOORWAY?"\x00s":0},39:function(){return modeDOORWAY?
"\x00t":0},48:function(){return cbm?146:0},49:function(){return cbm?144:0},50:function(){return cbm?5:atari?253:0},51:function(){return cbm?28:0},52:function(){return cbm?159:0},53:function(){return cbm?156:0},54:function(){return cbm?30:0},55:function(){return cbm?31:0},56:function(){return cbm?158:0},57:function(){return cbm?18:0},65:1,66:2,67:null,68:4,69:5,70:6,71:7,72:8,73:9,74:10,75:11,76:12,77:13,78:null,79:15,80:16,81:17,82:18,83:19,84:null,85:21,86:null,87:null,88:24,89:25,90:26,112:function(){return modeDOORWAY?
"\x00^":0},113:function(){return modeDOORWAY?"\x00_":0},114:function(){return modeDOORWAY?"\x00`":0},115:function(){return modeDOORWAY?"\x00a":0},116:null,117:function(){return modeDOORWAY?"\x00c":0},118:function(){return modeDOORWAY?"\x00d":0},119:function(){return modeDOORWAY?"\x00e":0},120:function(){return modeDOORWAY?"\x00f":0},121:function(){return modeDOORWAY?"\x00g":0},219:27,220:28,221:29},keysS1C1A0={},keysS0C0A1={49:function(){return cbm?129:0},50:function(){return cbm?149:0},51:function(){return cbm?
150:0},52:function(){return cbm?151:0},53:function(){return cbm?152:0},54:function(){return cbm?153:0},55:function(){return cbm?154:0},56:function(){return cbm?155:0},112:function(){return modeDOORWAY?"\x00h":0},113:function(){return modeDOORWAY?"\x00i":0},114:function(){return modeDOORWAY?"\x00j":0},115:function(){return modeDOORWAY?"\x00k":0},116:function(){return modeDOORWAY?"\x00l":0},117:function(){return modeDOORWAY?"\x00m":0},118:function(){return modeDOORWAY?"\x00n":0},119:function(){return modeDOORWAY?
"\x00o":0},120:function(){return modeDOORWAY?"\x00p":0},121:function(){return modeDOORWAY?"\x00q":0}},keysS1C0A1={},keysS0C1A1={46:null},keysS1C1A1={},keyVals=[keysS0C0A0,keysS1C0A0,keysS0C1A0,keysS1C1A0,keysS0C0A1,keysS1C0A1,keysS0C1A1,keysS1C1A1],vtxFonts="UVGA16 MICROKNIGHT MICROKNIGHTPLUS MOSOUL P0TNOODLE TOPAZ TOPAZPLUS VIC200 VIC201 C640 C641 C1280 C1281 ATARI TI994".split(" "),TN_IS=0,TN_SEND=1,TN_BIN=0,TN_ECHO=1,TN_RECONNECT=2,TN_SGA=3,TN_STATUS=5,TN_TMARK=6,TN_SLOC=23,TN_TTYPE=24,TN_NAWS=
31,TN_TSPEED=32,TN_RFC=33,TN_LM=34,TN_XLOC=35,TN_EVARS=36,TN_AUTH=37,TN_NEWE=39,TN_SE=240,TN_NOP=241,TN_DM=242,TN_BRK=243,TN_IP=244,TN_AO=245,TN_AYT=246,TN_EC=247,TN_EL=248,TN_GA=249,TN_SB=250,TN_WILL=251,TN_WONT=252,TN_DO=253,TN_DONT=254,TN_IAC=255,TNQ_NO=0,TNQ_YES=1,TNQ_WANTNO=2,TNQ_WANTYES=3,TNQ_WANTNO_OP=4,TNQ_WANTYES_OP=5,CRC_POLY=4129,codePage=vtxdata.codePage,wsConnect=vtxdata.wsConnect,crtCols=vtxdata.crtCols,crtRows=vtxdata.crtRows,xScale=vtxdata.xScale,term=vtxdata.term,cbm="PETSCII"==vtxdata.term,
atari="ATASCII"==vtxdata.term,initStr=vtxdata.initStr,cbmColors,ws=null,irqWriteBuffer=null,irqCheckResize=null,irqCursor=null,irqBlink=null,fontName,fontSize,vtxFontsLoaded,rowSize,colSize,crtWidth,pageWidth,pagePos,pageLeft,pageTop,elPage=document.getElementsByTagName("html")[0],crsr,crsrRow,crsrCol,crsrSaveRow=0,crsrSaveCol=0,cellSaveAttr=0,pageAttr,crsrAttr,crsrBlink,crsrSkipTime,cellAttr,cellBlinkSlow,cellBlinkFast,defPageAttr,defCrsrAttr,defCellAttr,defRowAttr=2883584,lastChar,lastHotSpot=null,
hotspotHoverAttr,hotspotClickAttr,conBaud=0,audio,termState,pageDiv=null,ctrlDiv=null,textDiv=null,soundBell=null,textPos=null,parms="",interm="",ansiState=0,modeVTXANSI=!1,modeBlinkBright=!1,modeCursor=!0,modeBoldFont=!1,modeNoBold=!1,modeBlinkFont=!1,modeNoBlink=!1,modeCBMShift=!0,modeDOORWAY=!1,modeAutoWrap=!0,modeSaveAutoWrap,modeNextGlyph=!1,modeRegionOrigin,modeTeletext=!1,regionTopRow,regionBottomRow,conBuffer="",conRowAttr=[],conCellAttr=[],conText=[],conHotSpots=[],spriteDefs=[],audioDefs=
[],conTabStop=[],conFont=[],conFontCP=[],conFontNum=0,ovl={},shiftState,ctrlState,altState,numState,capState,scrState,tnState,tnCmd,tnQUs=new Uint8Array(256),tnQHim=new Uint8Array(256),ymTimer,ymCCount,ymPacketSize,ymPacketPos,ymPacketBuff=[],ymFileName,ymFileSize,ymModifiedDate,ymFilePos,ymFileData=new Blob([],{type:"application/octet-stream"}),ymEOTCount,ymNakCount,ymNextBlock,ymSendStartTime;
String.prototype.splice||(String.prototype.splice=function(a,b,d){0>a&&(a=this.length+a,0>a&&(a=0));return this.slice(0,a)+(d||"")+this.slice(a+b)});var ttxGraphics,ttxSeparated,ttxDouble,ttxBottom,ttxHeld;addListener(window,"load",bootVTX);